(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{382:function(e,t,r){Promise.resolve().then(r.bind(r,9474))},9474:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return C}});var l=r(3827),n=r(4090),s=r(954),o=r(5061),c=r(9812),a=r(8096),i=r(4710),d=r(9097),u=r(5548),m=r(4424),x=r(1310);let h={normal:{iconUrl:""}};function p(e){var t,r;let{characters:s,onAddCharacter:o,onUpdateCharacter:c,onDeleteCharacter:a}=e,[i,d]=(0,n.useState)(!1),[p,f]=(0,n.useState)(null),[g,v]=(0,n.useState)({name:"",emotions:{...h}}),[b,j]=(0,n.useState)(null),y=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!l)return;let n=new FileReader;n.onload=()=>{r?j(e=>({...null!=e?e:{},emotions:{normal:{iconUrl:n.result}}})):v(e=>({...e,emotions:{normal:{iconUrl:n.result}}}))},n.readAsDataURL(l)},k=e=>{var t,r;e.preventDefault(),b&&b.name&&(null===(r=b.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)&&(c({id:b.id,name:b.name,emotions:{normal:{iconUrl:b.emotions.normal.iconUrl}}}),f(null),j(null))};return(0,l.jsxs)("div",{className:"space-y-4",children:[s.map(e=>{var t,r;return(0,l.jsx)("div",{className:"border rounded p-3 flex items-center justify-between bg-background",children:p===e.id?(0,l.jsxs)("form",{onSubmit:k,className:"flex-1 space-y-2",children:[(0,l.jsx)("input",{type:"text",value:(null==b?void 0:b.name)||"",onChange:e=>j(t=>({...null!=t?t:{},name:e.target.value})),placeholder:"キャラクター名",className:"w-full p-2 border rounded bg-background text-foreground",required:!0}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("input",{type:"text",value:(null==b?void 0:null===(r=b.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||"",onChange:e=>j(t=>({...null!=t?t:{},emotions:{normal:{iconUrl:e.target.value}}})),placeholder:"アイコンURLまたは画像を選択",className:"flex-1 p-2 border rounded bg-background text-foreground",required:!0}),(0,l.jsxs)("label",{className:"cursor-pointer bg-primary text-primary-foreground px-3 py-1 rounded text-xs hover:bg-primary/90 transition-colors",children:["ファイルを選択",(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>y(e,!0),className:"hidden"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{f(null),j(null)},className:"px-3 py-1 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"保存"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 md:mt-0",children:[(0,l.jsx)("div",{className:"flex items-center space-x-1",children:(0,l.jsx)("img",{src:e.emotions.normal.iconUrl,alt:e.name,className:"w-14 h-14 rounded-full border"})}),(0,l.jsx)("h3",{className:"font-semibold text-foreground flex items-center justify-center",children:e.name})]})}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsxs)("button",{onClick:()=>{f(e.id),j({...e})},className:"p-2 text-destructive hover:bg-destructive/10 rounded flex items-center",children:[(0,l.jsx)(u.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"ml-1 text-xs",children:"編集"})]}),(0,l.jsxs)("button",{onClick:()=>a(e.id),className:"p-2 text-destructive hover:bg-destructive/10 rounded flex items-center",children:[(0,l.jsx)(m.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"ml-1 text-xs",children:"削除"})]})]})]})},e.id)}),i?(0,l.jsxs)("form",{onSubmit:e=>{var t,r;e.preventDefault(),g.name&&(null===(r=g.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)&&(o({id:Date.now().toString(),name:g.name,emotions:{normal:{iconUrl:g.emotions.normal.iconUrl}}}),v({name:"",emotions:{...h}}),d(!1))},className:"border rounded p-3 space-y-3 bg-background",children:[(0,l.jsx)("input",{type:"text",value:g.name,onChange:e=>v(t=>({...t,name:e.target.value})),placeholder:"キャラクター名",className:"w-full p-2 border rounded bg-background text-foreground",required:!0}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("input",{type:"text",value:(null===(r=g.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||"",onChange:e=>v(t=>({...t,emotions:{normal:{iconUrl:e.target.value}}})),placeholder:"アイコンURLまたは画像を選択",className:"flex-1 p-2 border rounded text-foreground",required:!0}),(0,l.jsxs)("label",{className:"cursor-pointer bg-primary text-primary-foreground px-3 py-1 rounded text-xs hover:bg-primary/90 transition-colors",children:["ファイルを選択",(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>y(e,!1),className:"hidden"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>d(!1),className:"px-3 py-1 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"追加"})]})]}):(0,l.jsxs)("button",{onClick:()=>d(!0),className:"w-full flex items-center justify-center space-x-2 p-2 border rounded hover:bg-accent text-foreground",children:[(0,l.jsx)(x.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"キャラクターを追加"})]})]})}function f(e){let{characters:t,onAddCharacter:r,onUpdateCharacter:u,onDeleteCharacter:m,onThemeChange:x,onExportCSV:h,onExportSerifOnly:f,onExportCharacterCSV:g,onImportCSV:v,onImportCharacterCSV:b,isDarkMode:j}=e,[y,k]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!1),[S,C]=(0,n.useState)(!1),[I,_]=(0,n.useState)(!1),E=(0,n.useRef)(null),U=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=e=>{E.current&&!E.current.contains(e.target)&&w(!1),U.current&&!U.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let D=(e,t)=>{var r;let l=null===(r=e.target.files)||void 0===r?void 0:r[0];l&&("script"===t?v(l):b(l),C(!1)),e.target.value=""};return(0,l.jsxs)("header",{className:"bg-background shadow-sm sticky top-0 z-50 border-b",children:[(0,l.jsxs)("div",{className:"max-w-6xl mx-auto px-4 flex items-center justify-between h-16",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold text-primary tracking-tight ",children:"VoiScripter."}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("div",{className:"relative",ref:E,children:[(0,l.jsx)("button",{onClick:()=>w(e=>!e),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"エクスポート",children:(0,l.jsx)(s.Z,{className:"w-7 h-7"})}),N&&(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-popover border rounded-lg shadow-lg z-10",children:[(0,l.jsx)("button",{onClick:()=>{h(),w(!1)},className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground",children:"CSVエクスポート（話者,セリフ）"}),(0,l.jsx)("button",{onClick:()=>{f(),w(!1)},className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground",children:"セリフだけエクスポート"}),(0,l.jsx)("button",{onClick:()=>{g(),w(!1)},className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground",children:"キャラクター設定エクスポート"})]})]}),(0,l.jsxs)("div",{className:"relative",ref:U,children:[(0,l.jsx)("button",{onClick:()=>C(e=>!e),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"インポート",children:(0,l.jsx)(o.Z,{className:"w-7 h-7"})}),S&&(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-popover border rounded-lg shadow-lg z-10",children:[(0,l.jsxs)("label",{className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground cursor-pointer",children:["CSVインポート（話者,セリフ）",(0,l.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>D(e,"script")})]}),(0,l.jsxs)("label",{className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground cursor-pointer",children:["キャラクター設定のインポート",(0,l.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>D(e,"character")})]})]})]}),(0,l.jsx)("button",{onClick:()=>k(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"キャラクター設定",children:(0,l.jsx)(c.Z,{className:"w-7 h-7"})}),(0,l.jsx)("button",{onClick:()=>{x(!j)},className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"ダークモード切替",children:j?(0,l.jsx)(a.Z,{className:"w-7 h-7"}):(0,l.jsx)(i.Z,{className:"w-7 h-7"})}),(0,l.jsx)("button",{onClick:()=>_(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"ヘルプ",children:(0,l.jsx)(d.Z,{className:"w-7 h-7"})})]})]}),y&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-card border rounded-lg p-6 w-full max-w-2xl mx-4 shadow-xl",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-card-foreground",children:"キャラクター管理"}),(0,l.jsx)("button",{onClick:()=>k(!1),className:"text-muted-foreground hover:text-foreground text-2xl",title:"閉じる",children:"\xd7"})]}),(0,l.jsx)(p,{characters:t,onAddCharacter:r,onUpdateCharacter:u,onDeleteCharacter:m})]})}),I&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-card border rounded-lg p-6 w-full max-w-2xl mx-4 shadow-xl overflow-y-auto max-h-[90vh]",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-card-foreground",children:"ヘルプ"}),(0,l.jsx)("button",{onClick:()=>_(!1),className:"text-muted-foreground hover:text-foreground text-2xl",title:"閉じる",children:"\xd7"})]}),(0,l.jsxs)("div",{className:"prose max-w-none text-foreground",children:[(0,l.jsx)("h3",{children:"Voiscripter. - ブラウザベースの合成音声系台本作成アプリ"}),(0,l.jsxs)("p",{children:["Voiscripter.は、ブラウザ上で脚本を作成・編集できるWebアプリケーションです。",(0,l.jsx)("br",{}),"合成音声系の台本作成に特化しています。",(0,l.jsx)("br",{}),"ブロックベースの編集で、ドラッグ・ショートカット操作による並び替えも可能です。",(0,l.jsx)("br",{}),"保存状態などは使用者のローカルストレージに保存されており、データの収集などがおこなわれることはありません。",(0,l.jsx)("br",{}),"作業状態は自動で保存されており、ブラウザを閉じてもデータは残ります。ただし、ブラウザのデータ消去などでデータが消える可能性があります。",(0,l.jsx)("br",{}),"適宜データのインポート・エクスポートを使用してデータを保存してください。"]}),(0,l.jsx)("h4",{children:"主な機能"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"キャラクター管理（追加、編集、削除）"}),(0,l.jsx)("li",{children:"感情設定とアイコン表示(ローカルPC・WEBの画像を指定可能)"}),(0,l.jsx)("li",{children:"ブロックベースの編集"}),(0,l.jsx)("li",{children:"ドラッグ&ドロップによるブロック並び替え"}),(0,l.jsx)("li",{children:"CSVインポート/エクスポート"}),(0,l.jsx)("li",{children:"ダークモード対応"}),(0,l.jsx)("li",{children:"台詞の入れ替えをショートカットでできる"})]}),(0,l.jsx)("h4",{children:"技術スタック"}),(0,l.jsxs)("ul",{children:[(0,l.jsx)("li",{children:"Next.js 14"}),(0,l.jsx)("li",{children:"TypeScript"}),(0,l.jsx)("li",{children:"TailwindCSS v4"}),(0,l.jsx)("li",{children:"React DnD Kit"})]}),(0,l.jsx)("h4",{children:"デプロイ"}),(0,l.jsx)("p",{children:"このプロジェクトはVercelにデプロイされています。"}),(0,l.jsx)("h4",{children:"ライセンス"}),(0,l.jsx)("p",{children:"MIT License"}),(0,l.jsx)("hr",{}),(0,l.jsx)("h3",{children:"ショートカット一覧"}),(0,l.jsxs)("ul",{children:[(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Ctrl+B"}),"：新規セリフブロックを作成"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Ctrl+Alt+B"}),"：新規ト書きブロックを作成"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Alt+B"}),"：選択中のブロックを削除"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Ctrl+↑/Ctrl+↓"}),"：ブロックの上下移動"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"↑/↓"}),"：テキストエリアの最上段/最下段にいる場合は前後のブロックに移動"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Alt+↑/Alt+↓"}),"：キャラクター選択（ト書き以外）"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Alt+→/Alt+←"}),"：感情選択"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Ctrl+Enter"}),"：キャラクター引き継ぎ新規ブロックを作成"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Ctrl+Z"}),"：元に戻す(アンドゥ)"]}),(0,l.jsxs)("li",{children:[(0,l.jsx)("b",{children:"Ctrl+Y"}),"：やり直し(リドゥ)"]})]})]})]})})]})}var g=r(7135),v=r(4048),b=r(1216),j=r(2360),y=r(1932),k=r(6254),N=r(7266);function w(e){var t;let{block:r,characters:n,character:s,onUpdate:o,onDelete:c,onDuplicate:a,onMoveUp:i,onMoveDown:d,textareaRef:u,isSelected:x}=e,{attributes:h,listeners:p,setNodeRef:f,transform:g,transition:w,isDragging:S}=(0,v.nB)({id:r.id}),C={transform:b.ux.Transform.toString(g),transition:w,opacity:S?.5:1},I=!r.characterId;return(0,l.jsxs)("div",{ref:f,style:C,className:"flex items-start space-x-2 p-2 border rounded-lg shadow mb-2 transition-colors ".concat(x?"bg-secondary-foreground/10":"bg-card"),children:[(0,l.jsx)("div",{...h,...p,className:"cursor-grab flex items-center justify-center w-8 h-6 rounded hover:bg-accent transition",children:(0,l.jsx)(j.Z,{className:"w-8 h-8 text-primary"})}),(0,l.jsxs)("div",{className:"flex-1",children:[I?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("textarea",{ref:u,value:r.text,onChange:e=>o({text:e.target.value}),placeholder:"ト書きを入力",className:"w-full p-2 border rounded min-h-[40px] bg-muted text-foreground focus:ring-1 focus:ring-ring text-sm italic focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400"}),(0,l.jsxs)("select",{value:r.characterId,onChange:e=>o({characterId:e.target.value}),className:"ml-1 p-2 pl-3 mr-2 border rounded bg-background text-foreground text-xs w-36",children:[(0,l.jsx)("option",{value:"",children:"ト書きを入力"}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})]}):(0,l.jsxs)("div",{className:"flex items-start space-x-2",children:[s&&(0,l.jsx)("img",{src:null===(t=s.emotions[r.emotion])||void 0===t?void 0:t.iconUrl,alt:s.name,className:"w-16 h-16 rounded-full object-cover mt-0 mr-2"}),(0,l.jsxs)("div",{className:"relative flex-1",children:[(0,l.jsx)("textarea",{ref:u,value:r.text,onChange:e=>o({text:e.target.value}),placeholder:"セリフを入力",className:"rounded-2xl border p-2 bg-card shadow-md min-h-[60px] text-sm w-full text-foreground focus:ring-1 focus:ring-ring focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400",style:{borderRadius:"20px 20px 20px 0"}}),(0,l.jsx)("div",{className:"absolute left-[-10px] top-6 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-gray-400 focus:ring-2 focus:ring-ring focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400"})]}),(0,l.jsx)("div",{className:"flex flex-col space-y-1 mr-2 mt-3",children:(0,l.jsxs)("select",{value:r.characterId,onChange:e=>o({characterId:e.target.value}),className:"ml-1 p-2 pl-3 border rounded bg-background text-foreground focus:ring-1 focus:ring-ring text-xs w-36",children:[(0,l.jsx)("option",{value:"",children:"ト書きを入力"}),n.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]})})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-1.5 mt-1 mr-1.5",children:[(0,l.jsx)("button",{onClick:i,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↑:ブロックを上に移動",children:(0,l.jsx)(y.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:d,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↓:ブロックを下に移動",children:(0,l.jsx)(k.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:a,className:"p-1 rounded hover:bg-accent",title:"Ctrl+B:ブロックを複製",children:(0,l.jsx)(N.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:c,className:"p-1 text-destructive hover:bg-destructive/10 rounded",title:"Alt+B:ブロックを削除",children:(0,l.jsx)(m.Z,{className:"w-6 h-6"})})]})]})]})}function S(e){let{script:t,onUpdateBlock:r,onAddBlock:s,onDeleteBlock:o,onInsertBlock:c,onMoveBlock:a}=e,i=(0,g.Dy)((0,g.VT)(g.we),(0,g.VT)(g.Lg,{coordinateGetter:v.is})),d=(0,n.useRef)([]),[u,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)(null),[p,f]=(0,n.useState)(null);(0,n.useEffect)(()=>{d.current=d.current.slice(0,t.blocks.length)},[t.blocks.length]),(0,n.useEffect)(()=>{let e=()=>{let e=document.querySelector(".script-editor-container");e&&m(e.scrollHeight>window.innerHeight-200)};e(),window.addEventListener("resize",e);let t=setTimeout(e,1);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[t.blocks]);let b=(0,n.useRef)(t.blocks.length);(0,n.useEffect)(()=>{if(t.blocks.length>b.current){if(p){f(null);return}setTimeout(()=>{var e,r;let l=t.blocks.length-1;null===(e=d.current[l])||void 0===e||e.focus(),h((null===(r=t.blocks[l])||void 0===r?void 0:r.id)||null)},10)}b.current=t.blocks.length},[t.blocks.length,p]),(0,n.useEffect)(()=>{let e=e=>{let r=e.target,l=d.current.findIndex(e=>e===r);if(l>=0){var n;h((null===(n=t.blocks[l])||void 0===n?void 0:n.id)||null)}},r=()=>{};return d.current.forEach(t=>{t&&(t.addEventListener("focus",e),t.addEventListener("blur",r))}),()=>{d.current.forEach(t=>{t&&(t.removeEventListener("focus",e),t.removeEventListener("blur",r))})}},[t.blocks]),(0,n.useEffect)(()=>{p&&setTimeout(()=>{var e;null===(e=d.current[p.index])||void 0===e||e.focus(),h(p.id),f(null)},10)},[p]),(0,n.useEffect)(()=>{let e=e=>{var l,n;let i=d.current.findIndex(e=>e===document.activeElement);if(e.ctrlKey&&!e.altKey&&"b"===e.key)e.preventDefault(),s(),setTimeout(()=>{var e;let r=t.blocks.length;f({index:r,id:(null===(e=t.blocks[r])||void 0===e?void 0:e.id)||""})},10);else if(e.ctrlKey&&e.altKey&&"b"===e.key){e.preventDefault();let r=i>=0?i+1:t.blocks.length,l={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:""};c(l,r),setTimeout(()=>{f({index:r,id:l.id})},10)}else if(!e.ctrlKey&&e.altKey&&"b"===e.key)i>=0&&(e.preventDefault(),o(t.blocks[i].id),setTimeout(()=>{var e,t;d.current[i]?null===(e=d.current[i])||void 0===e||e.focus():d.current[i-1]&&(null===(t=d.current[i-1])||void 0===t||t.focus())},0));else if(!e.ctrlKey&&e.altKey&&"ArrowUp"===e.key){if(i>=0){let l=t.blocks[i];if(l.characterId){let n=t.characters.findIndex(e=>e.id===l.characterId);n>0&&(e.preventDefault(),r(l.id,{characterId:t.characters[n-1].id}))}}}else if(!e.ctrlKey&&e.altKey&&"ArrowDown"===e.key){if(i>=0){let l=t.blocks[i];if(l.characterId){let n=t.characters.findIndex(e=>e.id===l.characterId);n>=0&&n<t.characters.length-1&&(e.preventDefault(),r(l.id,{characterId:t.characters[n+1].id}))}}}else if(e.ctrlKey||"ArrowUp"!==e.key){if(e.ctrlKey||"ArrowDown"!==e.key){if(e.ctrlKey&&"Enter"===e.key){if(i>=0){e.preventDefault();let r=t.blocks[i],l={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:r.characterId,emotion:r.emotion,text:""};c(l,i+1),setTimeout(()=>{f({index:i+1,id:l.id})},10)}}else e.ctrlKey&&"ArrowUp"===e.key?i>0&&(e.preventDefault(),a(i,i-1),setTimeout(()=>{var e;f({index:i-1,id:(null===(e=t.blocks[i-1])||void 0===e?void 0:e.id)||""})},10)):e.ctrlKey&&"ArrowDown"===e.key&&i>=0&&i<t.blocks.length-1&&(e.preventDefault(),a(i,i+1),setTimeout(()=>{var e;f({index:i+1,id:(null===(e=t.blocks[i+1])||void 0===e?void 0:e.id)||""})},10))}else if(i>=0&&i<t.blocks.length-1){let t=d.current[i];if(t){let{selectionStart:r}=t,l=t.value;l.slice(0,r).split("\n").length===l.split("\n").length&&(e.preventDefault(),null===(n=d.current[i+1])||void 0===n||n.focus())}}}else if(i>0){let t=d.current[i];if(t){let{selectionStart:r}=t;1===t.value.slice(0,r).split("\n").length&&(e.preventDefault(),null===(l=d.current[i-1])||void 0===l||l.focus())}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t.blocks,s,c,a,o]);let j=e=>{c({id:Date.now().toString(),characterId:"",emotion:"normal",text:""},e),setTimeout(()=>{var t;null===(t=d.current[e])||void 0===t||t.focus()},0)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"script-editor-container",children:0===t.blocks.length?(0,l.jsx)("div",{className:"flex flex-col items-center justify-center p-8 text-center text-muted-foreground",children:(0,l.jsx)("p",{className:"text-lg mb-4",children:"キャラクターのアイコンから話者を追加して下のボタンからブロックを追加します。"})}):(0,l.jsx)("div",{className:"bg-card border rounded-lg shadow p-4 relative",children:(0,l.jsx)(g.LB,{sensors:i,collisionDetection:g.pE,onDragEnd:e=>{let{active:r,over:l}=e;l&&r.id!==l.id&&a(t.blocks.findIndex(e=>e.id===r.id),t.blocks.findIndex(e=>e.id===l.id))},children:(0,l.jsx)(v.Fo,{items:t.blocks.map(e=>e.id),strategy:v.qw,children:t.blocks.map((e,n)=>(0,l.jsxs)("div",{children:[(0,l.jsx)(w,{block:e,characters:t.characters,character:t.characters.find(t=>t.id===e.characterId),onUpdate:t=>r(e.id,t),onDelete:()=>o(e.id),onDuplicate:()=>{let t={...e,id:Date.now().toString()+Math.random().toString(36).substr(2,9),text:e.text};c(t,n+1),setTimeout(()=>{f({index:n+1,id:t.id})},10)},onMoveUp:()=>{n>0&&a(n,n-1)},onMoveDown:()=>{n<t.blocks.length-1&&a(n,n+1)},textareaRef:e=>d.current[n]=e,isSelected:x===e.id}),(0,l.jsx)("div",{className:"flex justify-center my-1 group",children:(0,l.jsx)("button",{className:"hidden group-hover:inline-block px-2 py-1 bg-primary text-primary-foreground rounded text-xs",onClick:()=>j(n+1),children:"＋ト書きを追加"})})]},e.id))})})})}),(0,l.jsx)("button",{onClick:s,className:"fixed right-6 z-40 px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-full shadow-lg transition-all text-lg ".concat(0===t.blocks.length?"bottom-1/2 transform translate-y-1/2":"bottom-6"),title:"Ctrl+B:新規ブロックを追加",children:"＋ブロックを追加"})]})}function C(){let[e,t]=(0,n.useState)([]),[r,s]=(0,n.useState)("default"),[o,c]=(0,n.useState)([]),[a,i]=(0,n.useState)([]),[d,u]=(0,n.useState)([]),[m,x]=(0,n.useState)({id:"1",title:"新しい台本",blocks:[]});(0,n.useEffect)(()=>{let e=localStorage.getItem("voiscripter_characters");e&&t(JSON.parse(e));let r=localStorage.getItem("voiscripter_lastProject"),l=r&&"lastProject"!==r?r:"default";s(l),c(Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e).map(e=>e.replace("voiscripter_","")));let n=localStorage.getItem("voiscripter_".concat(l));if(n)try{x(JSON.parse(n))}catch(e){console.error("Script parse error:",e),x({id:"1",title:"新しい台本",blocks:[]})}let o=localStorage.getItem("voiscripter_".concat(l,"_undo"));if(o)try{i(JSON.parse(o))}catch(e){console.error("Undo stack parse error:",e),i([])}let a=localStorage.getItem("voiscripter_".concat(l,"_redo"));if(a)try{u(JSON.parse(a))}catch(e){console.error("Redo stack parse error:",e),u([])}},[]);let h=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(h.current){h.current=!1;return}localStorage.setItem("voiscripter_characters",JSON.stringify(e))},[e]),(0,n.useEffect)(()=>{localStorage.setItem("voiscripter_lastProject",r);let e=localStorage.getItem("voiscripter_".concat(r));x(e?JSON.parse(e):{id:"1",title:"新しい台本",blocks:[]}),i(()=>{let e=localStorage.getItem("voiscripter_".concat(r,"_undo"));return e?JSON.parse(e):[]}),u(()=>{let e=localStorage.getItem("voiscripter_".concat(r,"_redo"));return e?JSON.parse(e):[]}),c(Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e).map(e=>e.replace("voiscripter_","")))},[r]);let p=(0,n.useRef)(!0);(0,n.useEffect)(()=>{if(p.current){p.current=!1;return}i(e=>{let t=[...e,m];return localStorage.setItem("voiscripter_".concat(r,"_undo"),JSON.stringify(t)),t}),u([]),localStorage.removeItem("voiscripter_".concat(r,"_redo")),localStorage.setItem("voiscripter_".concat(r),JSON.stringify(m))},[m,r]),(0,n.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"z"===e.key.toLowerCase()){if(e.preventDefault(),a.length>0){u(e=>{let t=[m,...e];return localStorage.setItem("voiscripter_".concat(r,"_redo"),JSON.stringify(t)),t});let e=a[a.length-1];i(e=>{let t=e.slice(0,-1);return localStorage.setItem("voiscripter_".concat(r,"_undo"),JSON.stringify(t)),t}),x(e)}}else if(e.ctrlKey&&"y"===e.key.toLowerCase()&&(e.preventDefault(),d.length>0)){let e=d[0];i(e=>{let t=[...e,m];return localStorage.setItem("voiscripter_".concat(r,"_undo"),JSON.stringify(t)),t}),u(e=>{let t=e.slice(1);return localStorage.setItem("voiscripter_".concat(r,"_redo"),JSON.stringify(t)),t}),x(e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,d,m,r]);let[g,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,r="dark"===e||!e&&t;v(r),document.documentElement.classList.toggle("dark",r)};e();let t=window.matchMedia("(prefers-color-scheme: dark)"),r=()=>{localStorage.getItem("theme")||e()};return t.addEventListener("change",r),()=>{t.removeEventListener("change",r)}},[]);let b=async t=>{try{let r=(await t.text()).split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>{let t=[],r="",l=!1;for(let n=0;n<e.length;n++){let s=e[n];'"'===s?l&&'"'===e[n+1]?(r+='"',n++):l=!l:","!==s||l?r+=s:(t.push(r.trim()),r="")}return t.push(r.trim()),t}).slice(1).filter(e=>e.length>=2&&(e[0]||e[1])).map(t=>{let[r,l]=t,n=e.find(e=>e.name===r);return n?{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:n.id,emotion:"normal",text:l||""}:{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:"【".concat(r,"】").concat(l||"")}});x(e=>({...e,blocks:[...e.blocks,...r]})),alert("".concat(r.length,"個のブロックをインポートしました。"))}catch(e){console.error("CSVインポートエラー:",e),alert("CSVファイルのインポートに失敗しました。")}},j=async e=>{try{let r=(await e.text()).split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>{let t=[],r="",l=!1;for(let n=0;n<e.length;n++){let s=e[n];'"'===s?l&&'"'===e[n+1]?(r+='"',n++):l=!l:","!==s||l?r+=s:(t.push(r.trim()),r="")}return t.push(r.trim()),t}).slice(1).filter(e=>e.length>=1&&""!==e[0].trim()).map(e=>{let[t,r]=e;return{id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:t,emotions:{normal:{iconUrl:r||""}}}});t(e=>[...e,...r]),alert("".concat(r.length,"個のキャラクターをインポートしました。"))}catch(e){console.error("キャラクター設定のCSVインポートエラー:",e),alert("キャラクター設定のCSVファイルのインポートに失敗しました。")}};return(0,l.jsx)("div",{id:"root",children:(0,l.jsxs)("div",{className:"min-h-screen bg-background text-foreground transition-colors duration-300",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[(0,l.jsx)("label",{children:"プロジェクト: "}),(0,l.jsx)("select",{value:r,onChange:e=>s(e.target.value),className:"border rounded p-1",children:o.map(e=>(0,l.jsx)("option",{value:e,children:e},e))}),(0,l.jsx)("button",{onClick:()=>{let e=prompt("新しいプロジェクト名を入力してください");if(e){if(o.includes(e)){alert("同名のプロジェクトが既に存在します");return}s(e),c(t=>[...t,e]),localStorage.setItem("voiscripter_".concat(e),JSON.stringify({id:"1",title:e,blocks:[]})),localStorage.setItem("voiscripter_lastProject",e)}},className:"px-2 py-1 bg-primary text-primary-foreground rounded",children:"新規作成"}),"default"!==r&&(0,l.jsx)("button",{onClick:()=>{if("default"===r){alert("デフォルトプロジェクトは削除できません");return}confirm("プロジェクト「".concat(r,"」を削除しますか？\nこの操作は元に戻せません。"))&&(localStorage.removeItem("voiscripter_".concat(r)),localStorage.removeItem("voiscripter_".concat(r,"_undo")),localStorage.removeItem("voiscripter_".concat(r,"_redo")),c(e=>e.filter(e=>e!==r)),s("default"),x({id:"1",title:"新しい台本",blocks:[]}),i([]),u([]))},className:"px-2 py-1 bg-destructive text-destructive-foreground rounded",children:"削除"})]}),(0,l.jsx)(f,{characters:e,onAddCharacter:e=>{t(t=>[...t,e])},onUpdateCharacter:e=>{t(t=>t.map(t=>t.id===e.id?e:t))},onDeleteCharacter:e=>{t(t=>t.filter(t=>t.id!==e)),x(t=>({...t,blocks:t.blocks.map(t=>t.characterId===e?{...t,characterId:""}:t)}))},onThemeChange:e=>{v(e),localStorage.setItem("theme",e?"dark":"light"),document.documentElement.classList.toggle("dark",e)},onExportCSV:()=>{let t=[["話者","セリフ"],...m.blocks.filter(e=>e.characterId).map(t=>{let r=e.find(e=>e.id===t.characterId);return[r?r.name:"",t.text]})].map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download="".concat(m.title||"script",".csv"),n.click(),URL.revokeObjectURL(l)},onExportSerifOnly:()=>{let e=[["セリフ"],...m.blocks.filter(e=>e.characterId).map(e=>[e.text])].map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),l=document.createElement("a");l.href=r,l.download="".concat(m.title||"serif",".csv"),l.click(),URL.revokeObjectURL(r)},onExportCharacterCSV:()=>{let t=[["名前","アイコン"],...e.map(e=>[e.name,e.emotions.normal.iconUrl])].map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(r),n=document.createElement("a");n.href=l,n.download="characters.csv",n.click(),URL.revokeObjectURL(l)},onImportCSV:b,onImportCharacterCSV:j,isDarkMode:g}),(0,l.jsx)("main",{className:"p-4",children:(0,l.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,l.jsx)(S,{script:{...m,characters:e},onUpdateBlock:(e,t)=>{x(r=>({...r,blocks:r.blocks.map(r=>r.id===e?{...r,...t}:r)}))},onAddBlock:()=>{var t;let r=[...m.blocks].reverse().find(e=>e.characterId),l=(null==r?void 0:r.characterId)||(null===(t=e[0])||void 0===t?void 0:t.id)||"",n=(null==r?void 0:r.emotion)||"normal",s={id:Date.now().toString(),characterId:l,emotion:n,text:""};x(e=>({...e,blocks:[...e.blocks,s]}))},onDeleteBlock:e=>{x(t=>({...t,blocks:t.blocks.filter(t=>t.id!==e)}))},onInsertBlock:(e,t)=>{x(r=>{let l=[...r.blocks];return l.splice(t,0,e),{...r,blocks:l}})},onMoveBlock:(e,t)=>{x(r=>{let l=[...r.blocks],[n]=l.splice(e,1);return l.splice(t,0,n),{...r,blocks:l}})}})})})]})})}}},function(e){e.O(0,[969,971,69,744],function(){return e(e.s=382)}),_N_E=e.O()}]);