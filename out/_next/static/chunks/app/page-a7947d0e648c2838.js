(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{382:function(e,t,r){Promise.resolve().then(r.bind(r,2110))},2110:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return U}});var s=r(3827),l=r(4090),n=r(954),o=r(5061),a=r(9812),c=r(8096),i=r(4710),d=r(4102),u=r(5548),m=r(4424),x=r(1310);let p={normal:{iconUrl:""}};function h(e){var t,r;let{characters:n,onAddCharacter:o,onUpdateCharacter:a,onDeleteCharacter:c,groups:i,onAddGroup:h,onDeleteGroup:f}=e,[g,v]=(0,l.useState)(!1),[b,j]=(0,l.useState)(null),[y,N]=(0,l.useState)(!1),[w,k]=(0,l.useState)(""),[S,C]=(0,l.useState)({name:"",group:"なし",emotions:{...p}}),[_,I]=(0,l.useState)(null),D=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;let l=new FileReader;l.onload=()=>{r?I(e=>({...null!=e?e:{},emotions:{normal:{iconUrl:l.result}}})):C(e=>({...e,emotions:{normal:{iconUrl:l.result}}}))},l.readAsDataURL(s)},E=e=>{var t,r;e.preventDefault(),_&&_.name&&(null===(r=_.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)&&(a({id:_.id,name:_.name,group:_.group||"なし",emotions:{normal:{iconUrl:_.emotions.normal.iconUrl}}}),j(null),I(null))};return(0,s.jsxs)("div",{className:"space-y-4",children:[n.map(e=>{var t,r;return(0,s.jsx)("div",{className:"border rounded p-3 flex items-center justify-between bg-background",children:b===e.id?(0,s.jsxs)("form",{onSubmit:E,className:"flex-1 space-y-2",children:[(0,s.jsx)("input",{type:"text",value:(null==_?void 0:_.name)||"",onChange:e=>I(t=>({...null!=t?t:{},name:e.target.value})),placeholder:"キャラクター名",className:"w-full p-2 border rounded bg-background text-foreground",required:!0}),(0,s.jsxs)("select",{value:(null==_?void 0:_.group)||"なし",onChange:e=>I(t=>({...null!=t?t:{},group:e.target.value})),className:"w-full p-2 border rounded bg-background text-foreground",children:[(0,s.jsx)("option",{value:"なし",children:"なし"}),i.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)("input",{type:"text",value:(null==_?void 0:null===(r=_.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||"",onChange:e=>I(t=>({...null!=t?t:{},emotions:{normal:{iconUrl:e.target.value}}})),placeholder:"アイコンURLまたは画像を選択",className:"flex-1 p-2 border rounded bg-background text-foreground",required:!0}),(0,s.jsxs)("label",{className:"cursor-pointer bg-primary text-primary-foreground px-3 py-1 rounded text-xs hover:bg-primary/90 transition-colors",children:["ファイルを選択",(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>D(e,!0),className:"hidden"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{j(null),I(null)},className:"px-3 py-1 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,s.jsx)("button",{type:"submit",className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"保存"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 md:mt-0",children:[(0,s.jsx)("div",{className:"flex items-center space-x-1",children:(0,s.jsx)("img",{src:e.emotions.normal.iconUrl,alt:e.name,className:"w-14 h-14 rounded-full border"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold text-foreground",children:e.name}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["グループ: ",e.group||"なし"]})]})]})}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsxs)("button",{onClick:()=>{j(e.id),I({...e})},className:"p-2 text-destructive hover:bg-destructive/10 rounded flex items-center",children:[(0,s.jsx)(u.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"ml-1 text-xs",children:"編集"})]}),(0,s.jsxs)("button",{onClick:()=>c(e.id),className:"p-2 text-destructive hover:bg-destructive/10 rounded flex items-center",children:[(0,s.jsx)(m.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{className:"ml-1 text-xs",children:"削除"})]})]})]})},e.id)}),g?(0,s.jsxs)("form",{onSubmit:e=>{var t,r;e.preventDefault(),S.name&&(null===(r=S.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)&&(o({id:Date.now().toString(),name:S.name,group:S.group||"なし",emotions:{normal:{iconUrl:S.emotions.normal.iconUrl}}}),C({name:"",group:"なし",emotions:{...p}}),v(!1))},className:"border rounded p-3 space-y-3 bg-background",children:[(0,s.jsx)("input",{type:"text",value:S.name,onChange:e=>C(t=>({...t,name:e.target.value})),placeholder:"キャラクター名",className:"w-full p-2 border rounded bg-background text-foreground",required:!0}),(0,s.jsxs)("select",{value:S.group||"なし",onChange:e=>C(t=>({...t,group:e.target.value})),className:"w-full p-2 border rounded bg-background text-foreground",children:[(0,s.jsx)("option",{value:"なし",children:"なし"}),i.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,s.jsx)("input",{type:"text",value:(null===(r=S.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||"",onChange:e=>C(t=>({...t,emotions:{normal:{iconUrl:e.target.value}}})),placeholder:"アイコンURLまたは画像を選択",className:"flex-1 p-2 border rounded text-foreground",required:!0}),(0,s.jsxs)("label",{className:"cursor-pointer bg-primary text-primary-foreground px-3 py-1 rounded text-xs hover:bg-primary/90 transition-colors",children:["ファイルを選択",(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>D(e,!1),className:"hidden"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>v(!1),className:"px-3 py-1 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,s.jsx)("button",{type:"submit",className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"追加"})]})]}):(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsxs)("button",{onClick:()=>N(!0),className:"flex-1 flex items-center justify-center space-x-2 p-2 border rounded hover:bg-accent text-foreground",style:{flex:"0 0 33.333%"},children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),(0,s.jsx)("span",{className:"text-xs",children:"グループ設定"})]}),(0,s.jsxs)("button",{onClick:()=>v(!0),className:"flex-1 flex items-center justify-center space-x-2 p-2 border rounded hover:bg-accent text-foreground",style:{backgroundColor:"var(--color-primary)",color:"var(--color-primary-foreground)"},children:[(0,s.jsx)(x.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"キャラクターを追加"})]})]}),y&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4 p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"グループ設定"}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("input",{type:"text",value:w,onChange:e=>k(e.target.value),placeholder:"新しいグループ名",className:"flex-1 p-2 border rounded bg-background text-foreground"}),(0,s.jsx)("button",{onClick:()=>{w.trim()&&!i.includes(w.trim())&&(h(w.trim()),k(""))},className:"px-3 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"追加"})]})}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"font-medium text-foreground",children:"既存のグループ"}),0===i.length?(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"グループがありません"}):i.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded bg-muted/30",children:[(0,s.jsx)("span",{className:"text-foreground",children:e}),(0,s.jsx)("button",{onClick:()=>f(e),className:"p-1 text-destructive hover:bg-destructive/10 rounded",children:(0,s.jsx)(m.Z,{className:"w-4 h-4"})})]},e))]}),(0,s.jsx)("div",{className:"flex justify-end mt-6",children:(0,s.jsx)("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"閉じる"})})]})})]})}var f=r(8621),g=r(9097);function v(e){let{isOpen:t,onClose:r,saveDirectory:n,onSaveDirectoryChange:o}=e,[a,c]=(0,l.useState)("settings"),[i,u]=(0,l.useState)(!1),m=async()=>{if(!window.electronAPI){alert("この機能はデスクトップアプリ版でのみ利用できます(開発中)");return}u(!0);try{let e=await window.electronAPI.selectDirectory();e&&o(e)}catch(e){console.error("ディレクトリ選択エラー:",e)}finally{u(!1)}};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-2xl mx-4 h-[600px] overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"設定"}),(0,s.jsx)("button",{onClick:r,className:"p-1 hover:bg-accent rounded transition-colors",children:(0,s.jsx)(f.Z,{className:"w-5 h-5 text-foreground"})})]}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsxs)("div",{className:"w-48 border-r bg-muted/30 h-[600px]",children:[(0,s.jsxs)("button",{onClick:()=>c("settings"),className:"w-full p-3 text-left flex items-center space-x-2 transition-colors ".concat("settings"===a?"bg-primary text-primary-foreground":"hover:bg-accent"),children:[(0,s.jsx)(d.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"設定"})]}),(0,s.jsxs)("button",{onClick:()=>c("help"),className:"w-full p-3 text-left flex items-center space-x-2 transition-colors ".concat("help"===a?"bg-primary text-primary-foreground":"hover:bg-accent"),children:[(0,s.jsx)(g.Z,{className:"w-5 h-5"}),(0,s.jsx)("span",{children:"ヘルプ"})]})]}),(0,s.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto",children:["settings"===a&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-foreground mb-4",children:"データの保存先"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"現在の保存先"}),(0,s.jsx)("div",{className:"p-3 bg-muted rounded border",children:n||"localStorage（ブラウザ）"})]}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:m,disabled:i,className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 transition-colors",children:i?"選択中...":"ディレクトリを選択"}),n&&(0,s.jsx)("button",{onClick:()=>{o("")},className:"px-4 py-2 bg-destructive text-destructive-foreground rounded hover:bg-destructive/90 transition-colors",children:"localStorageに戻す"})]}),(0,s.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,s.jsx)("p",{children:"• ディレクトリを選択すると、データがファイルとして保存されます"}),(0,s.jsx)("p",{children:"• 保存先を変更すると、既存のデータが自動的に移動されます"}),(0,s.jsx)("p",{children:"• 未設定の場合はlocalStorageに保存されます"})]})]})]})}),"help"===a&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-foreground mb-4",children:"VoiScripter ヘルプ"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"基本的な使い方"}),(0,s.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,s.jsx)("li",{children:"• キャラクターを追加して、アイコンを設定してください"}),(0,s.jsx)("li",{children:"• 「＋ブロックを追加」ボタンでセリフを追加できます"}),(0,s.jsx)("li",{children:"• キャラクターを選択してセリフを入力してください"}),(0,s.jsx)("li",{children:"• ドラッグ&ドロップでブロックの順序を変更できます"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"キーボードショートカット"}),(0,s.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+B"})," 新規ブロック追加"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Alt+B"})," ト書き追加"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Alt+B"})," ブロック削除"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Z"})," 元に戻す"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Y"})," やり直し"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+↑/↓"})," ブロック移動"]}),(0,s.jsxs)("li",{children:["• ",(0,s.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Alt+↑/↓"})," キャラクター選択"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"プロジェクト管理"}),(0,s.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,s.jsx)("li",{children:"• 複数のプロジェクトを作成・管理できます"}),(0,s.jsx)("li",{children:"• プロジェクトは自動的に保存されます"}),(0,s.jsx)("li",{children:"• 設定でデータの保存先を変更できます"})]})]})]})]})})]})]})]})}):null}function b(e){let{isOpen:t,onClose:r,characters:n,groups:o,onExportCSV:a,onExportSerifOnly:c,onExportByGroups:i}=e,[d,u]=(0,l.useState)("full"),[m,x]=(0,l.useState)([]),[p,h]=(0,l.useState)(!1),f=e=>{x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},g=()=>{x([]),h(!1),u("full"),r()};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4 p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"CSVエクスポート"}),(0,s.jsx)("button",{onClick:g,className:"text-muted-foreground hover:text-foreground text-2xl",title:"閉じる",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"エクスポートタイプ"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"exportType",value:"full",checked:"full"===d,onChange:e=>u(e.target.value),className:"text-primary"}),(0,s.jsx)("span",{className:"text-foreground",children:"CSVエクスポート（話者, セリフ）"})]}),(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"radio",name:"exportType",value:"serif-only",checked:"serif-only"===d,onChange:e=>u(e.target.value),className:"text-primary"}),(0,s.jsx)("span",{className:"text-foreground",children:"セリフだけエクスポート"})]})]})]}),(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:p,onChange:e=>h(e.target.checked),className:"text-primary"}),(0,s.jsx)("span",{className:"text-foreground font-medium",children:"グループごとにエクスポート"})]})}),p&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"エクスポートするグループを選択"}),(0,s.jsx)("div",{className:"max-h-40 overflow-y-auto border rounded p-2 space-y-1",children:0===o.length?(0,s.jsx)("p",{className:"text-muted-foreground text-sm",children:"グループがありません"}):o.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer p-1 hover:bg-accent rounded",children:[(0,s.jsx)("input",{type:"checkbox",checked:m.includes(e),onChange:()=>f(e),className:"text-primary"}),(0,s.jsx)("span",{className:"text-foreground text-sm",children:e}),(0,s.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",n.filter(t=>t.group===e).length,"人)"]})]},e))}),0===m.length&&p&&(0,s.jsx)("p",{className:"text-destructive text-xs mt-1",children:"グループを選択してください"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{onClick:g,className:"px-4 py-2 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,s.jsx)("button",{onClick:()=>{p&&m.length>0?i(m,d):p||("full"===d?a():c()),r()},disabled:p&&0===m.length,className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed",children:"エクスポート"})]})]})}):null}function j(e){let{characters:t,onAddCharacter:r,onUpdateCharacter:u,onDeleteCharacter:m,onThemeChange:x,onExportCSV:p,onExportSerifOnly:f,onExportCharacterCSV:g,onExportByGroups:j,onImportCSV:y,onImportCharacterCSV:N,isDarkMode:w,saveDirectory:k,onSaveDirectoryChange:S,groups:C,onAddGroup:_,onDeleteGroup:I}=e,[D,E]=(0,l.useState)(!1),[U,A]=(0,l.useState)(!1),[L,O]=(0,l.useState)(!1),[P,R]=(0,l.useState)(!1),Z=(0,l.useRef)(null);(0,l.useEffect)(()=>{let e=e=>{Z.current&&!Z.current.contains(e.target)&&O(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let K=(e,t)=>{var r;let s=null===(r=e.target.files)||void 0===r?void 0:r[0];s&&("script"===t?y(s):N(s),O(!1)),e.target.value=""};return(0,s.jsxs)("header",{className:"bg-background shadow-sm sticky top-0 z-50 border-b",children:[(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-4 flex items-center justify-between h-16",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-primary tracking-tight ",children:"VoiScripter."}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>A(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"CSVエクスポート",children:(0,s.jsx)(n.Z,{className:"w-7 h-7"})}),(0,s.jsxs)("div",{className:"relative",ref:Z,children:[(0,s.jsx)("button",{onClick:()=>O(e=>!e),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"インポート",children:(0,s.jsx)(o.Z,{className:"w-7 h-7"})}),L&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-popover border rounded-lg shadow-lg z-10",children:[(0,s.jsxs)("label",{className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground cursor-pointer",children:["CSVインポート（話者,セリフ）",(0,s.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>K(e,"script")})]}),(0,s.jsxs)("label",{className:"block w-full text-left px-4 py-2 hover:bg-accent text-popover-foreground cursor-pointer",children:["キャラクター設定のインポート",(0,s.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>K(e,"character")})]})]})]}),(0,s.jsx)("button",{onClick:()=>E(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"キャラクター設定",children:(0,s.jsx)(a.Z,{className:"w-7 h-7"})}),(0,s.jsx)("button",{onClick:()=>{x(!w)},className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"ダークモード切替",children:w?(0,s.jsx)(c.Z,{className:"w-7 h-7"}):(0,s.jsx)(i.Z,{className:"w-7 h-7"})}),(0,s.jsx)("button",{onClick:()=>R(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"設定",children:(0,s.jsx)(d.Z,{className:"w-7 h-7"})})]})]}),D&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-card border rounded-lg p-6 w-full max-w-2xl mx-4 shadow-xl",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-card-foreground",children:"キャラクター管理"}),(0,s.jsx)("button",{onClick:()=>E(!1),className:"text-muted-foreground hover:text-foreground text-2xl",title:"閉じる",children:"\xd7"})]}),(0,s.jsx)(h,{characters:t,onAddCharacter:r,onUpdateCharacter:u,onDeleteCharacter:m,groups:C,onAddGroup:_,onDeleteGroup:I})]})}),P&&(0,s.jsx)(v,{isOpen:P,onClose:()=>R(!1),saveDirectory:k,onSaveDirectoryChange:S}),(0,s.jsx)(b,{isOpen:U,onClose:()=>A(!1),characters:t,groups:C,onExportCSV:p,onExportSerifOnly:f,onExportByGroups:j})]})}var y=r(7135),N=r(4048),w=r(1216),k=r(2360),S=r(1932),C=r(6254),_=r(7266);function I(e){var t;let{block:r,characters:l,character:n,onUpdate:o,onDelete:a,onDuplicate:c,onMoveUp:i,onMoveDown:d,textareaRef:u,isSelected:x}=e,{attributes:p,listeners:h,setNodeRef:f,transform:g,transition:v,isDragging:b}=(0,N.nB)({id:r.id}),j={transform:w.ux.Transform.toString(g),transition:v,opacity:b?.5:1},y=!r.characterId;return(0,s.jsxs)("div",{ref:f,style:j,className:"flex items-start space-x-2 p-2 border rounded-lg shadow mb-2 transition-colors ".concat(x?"bg-secondary-foreground/10":"bg-card"),children:[(0,s.jsx)("div",{...p,...h,className:"cursor-grab flex items-center justify-center w-8 h-6 rounded hover:bg-accent transition",children:(0,s.jsx)(k.Z,{className:"w-8 h-8 text-primary"})}),(0,s.jsxs)("div",{className:"flex-1",children:[y?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("textarea",{ref:u,value:r.text,onChange:e=>o({text:e.target.value}),placeholder:"ト書きを入力",className:"w-full p-2 border rounded min-h-[40px] bg-muted text-foreground focus:ring-1 focus:ring-ring text-sm italic focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400"}),(0,s.jsxs)("select",{value:r.characterId,onChange:e=>o({characterId:e.target.value}),className:"ml-1 p-2 pl-3 mr-2 border rounded bg-background text-foreground text-xs w-36",children:[(0,s.jsx)("option",{value:"",children:"ト書きを入力"}),l.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}):(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[n&&(0,s.jsx)("img",{src:null===(t=n.emotions[r.emotion])||void 0===t?void 0:t.iconUrl,alt:n.name,className:"w-16 h-16 rounded-full object-cover mt-0 mr-2"}),(0,s.jsxs)("div",{className:"relative flex-1",children:[(0,s.jsx)("textarea",{ref:u,value:r.text,onChange:e=>o({text:e.target.value}),placeholder:"セリフを入力",className:"rounded-2xl border p-2 bg-card shadow-md min-h-[60px] text-sm w-full text-foreground focus:ring-1 focus:ring-ring focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400",style:{borderRadius:"20px 20px 20px 0"}}),(0,s.jsx)("div",{className:"absolute left-[-10px] top-6 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-gray-400 focus:ring-2 focus:ring-ring focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400"})]}),(0,s.jsx)("div",{className:"flex flex-col space-y-1 mr-2 mt-3",children:(0,s.jsxs)("select",{value:r.characterId,onChange:e=>o({characterId:e.target.value}),className:"ml-1 p-2 pl-3 border rounded bg-background text-foreground focus:ring-1 focus:ring-ring text-xs w-36",children:[(0,s.jsx)("option",{value:"",children:"ト書きを入力"}),l.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-1.5 mt-1 mr-1.5",children:[(0,s.jsx)("button",{onClick:i,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↑:ブロックを上に移動",children:(0,s.jsx)(S.Z,{className:"w-6 h-6 text-foreground"})}),(0,s.jsx)("button",{onClick:d,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↓:ブロックを下に移動",children:(0,s.jsx)(C.Z,{className:"w-6 h-6 text-foreground"})}),(0,s.jsx)("button",{onClick:c,className:"p-1 rounded hover:bg-accent",title:"Ctrl+B:ブロックを複製",children:(0,s.jsx)(_.Z,{className:"w-6 h-6 text-foreground"})}),(0,s.jsx)("button",{onClick:a,className:"p-1 text-destructive hover:bg-destructive/10 rounded",title:"Alt+B:ブロックを削除",children:(0,s.jsx)(m.Z,{className:"w-6 h-6"})})]})]})]})}function D(e){let{script:t,onUpdateBlock:r,onAddBlock:n,onDeleteBlock:o,onInsertBlock:a,onMoveBlock:c}=e,i=(0,y.Dy)((0,y.VT)(y.we),(0,y.VT)(y.Lg,{coordinateGetter:N.is})),d=(0,l.useRef)([]),[u,m]=(0,l.useState)(!1),[x,p]=(0,l.useState)(null),[h,f]=(0,l.useState)(null);(0,l.useEffect)(()=>{d.current=d.current.slice(0,t.blocks.length)},[t.blocks.length]),(0,l.useEffect)(()=>{let e=()=>{let e=document.querySelector(".script-editor-container");e&&m(e.scrollHeight>window.innerHeight-200)};e(),window.addEventListener("resize",e);let t=setTimeout(e,1);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[t.blocks]);let g=(0,l.useRef)(t.blocks.length);(0,l.useEffect)(()=>{if(t.blocks.length>g.current){if(h){f(null);return}setTimeout(()=>{var e,r;let s=t.blocks.length-1;null===(e=d.current[s])||void 0===e||e.focus(),p((null===(r=t.blocks[s])||void 0===r?void 0:r.id)||null)},10)}g.current=t.blocks.length},[t.blocks.length,h]),(0,l.useEffect)(()=>{let e=e=>{let r=e.target,s=d.current.findIndex(e=>e===r);if(s>=0){var l;p((null===(l=t.blocks[s])||void 0===l?void 0:l.id)||null)}},r=()=>{};return d.current.forEach(t=>{t&&(t.addEventListener("focus",e),t.addEventListener("blur",r))}),()=>{d.current.forEach(t=>{t&&(t.removeEventListener("focus",e),t.removeEventListener("blur",r))})}},[t.blocks]),(0,l.useEffect)(()=>{h&&setTimeout(()=>{var e;null===(e=d.current[h.index])||void 0===e||e.focus(),p(h.id),f(null)},10)},[h]),(0,l.useEffect)(()=>{let e=e=>{var s,l;let i=d.current.findIndex(e=>e===document.activeElement);if(e.ctrlKey&&!e.altKey&&"b"===e.key)e.preventDefault(),n(),setTimeout(()=>{var e;let r=t.blocks.length;f({index:r,id:(null===(e=t.blocks[r])||void 0===e?void 0:e.id)||""})},10);else if(e.ctrlKey&&e.altKey&&"b"===e.key){e.preventDefault();let r=i>=0?i+1:t.blocks.length,s={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:""};a(s,r),setTimeout(()=>{f({index:r,id:s.id})},10)}else if(!e.ctrlKey&&e.altKey&&"b"===e.key)i>=0&&(e.preventDefault(),o(t.blocks[i].id),setTimeout(()=>{var e,t;d.current[i]?null===(e=d.current[i])||void 0===e||e.focus():d.current[i-1]&&(null===(t=d.current[i-1])||void 0===t||t.focus())},0));else if(!e.ctrlKey&&e.altKey&&"ArrowUp"===e.key){if(i>=0){let s=t.blocks[i];if(s.characterId){let l=t.characters.findIndex(e=>e.id===s.characterId);l>0&&(e.preventDefault(),r(s.id,{characterId:t.characters[l-1].id}))}}}else if(!e.ctrlKey&&e.altKey&&"ArrowDown"===e.key){if(i>=0){let s=t.blocks[i];if(s.characterId){let l=t.characters.findIndex(e=>e.id===s.characterId);l>=0&&l<t.characters.length-1&&(e.preventDefault(),r(s.id,{characterId:t.characters[l+1].id}))}}}else if(e.ctrlKey||"ArrowUp"!==e.key){if(e.ctrlKey||"ArrowDown"!==e.key){if(e.ctrlKey&&"Enter"===e.key){if(i>=0){e.preventDefault();let r=t.blocks[i],s={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:r.characterId,emotion:r.emotion,text:""};a(s,i+1),setTimeout(()=>{f({index:i+1,id:s.id})},10)}}else e.ctrlKey&&"ArrowUp"===e.key?i>0&&(e.preventDefault(),c(i,i-1),setTimeout(()=>{var e;f({index:i-1,id:(null===(e=t.blocks[i-1])||void 0===e?void 0:e.id)||""})},10)):e.ctrlKey&&"ArrowDown"===e.key&&i>=0&&i<t.blocks.length-1&&(e.preventDefault(),c(i,i+1),setTimeout(()=>{var e;f({index:i+1,id:(null===(e=t.blocks[i+1])||void 0===e?void 0:e.id)||""})},10))}else if(i>=0&&i<t.blocks.length-1){let t=d.current[i];if(t){let{selectionStart:r}=t,s=t.value;s.slice(0,r).split("\n").length===s.split("\n").length&&(e.preventDefault(),null===(l=d.current[i+1])||void 0===l||l.focus())}}}else if(i>0){let t=d.current[i];if(t){let{selectionStart:r}=t;1===t.value.slice(0,r).split("\n").length&&(e.preventDefault(),null===(s=d.current[i-1])||void 0===s||s.focus())}}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t.blocks,n,a,c,o]);let v=e=>{a({id:Date.now().toString(),characterId:"",emotion:"normal",text:""},e),setTimeout(()=>{var t;null===(t=d.current[e])||void 0===t||t.focus()},0)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"script-editor-container",children:0===t.blocks.length?(0,s.jsx)("div",{className:"flex flex-col items-center justify-center p-8 text-center text-muted-foreground",children:(0,s.jsx)("p",{className:"text-lg mb-4",children:"キャラクターのアイコンから話者を追加して下のボタンからブロックを追加します。"})}):(0,s.jsx)("div",{className:"bg-card border rounded-lg shadow p-4 relative",children:(0,s.jsx)(y.LB,{sensors:i,collisionDetection:y.pE,onDragEnd:e=>{let{active:r,over:s}=e;s&&r.id!==s.id&&c(t.blocks.findIndex(e=>e.id===r.id),t.blocks.findIndex(e=>e.id===s.id))},children:(0,s.jsx)(N.Fo,{items:t.blocks.map(e=>e.id),strategy:N.qw,children:t.blocks.map((e,l)=>(0,s.jsxs)("div",{children:[(0,s.jsx)(I,{block:e,characters:t.characters,character:t.characters.find(t=>t.id===e.characterId),onUpdate:t=>r(e.id,t),onDelete:()=>o(e.id),onDuplicate:()=>{let t={...e,id:Date.now().toString()+Math.random().toString(36).substr(2,9),text:e.text};a(t,l+1),setTimeout(()=>{f({index:l+1,id:t.id})},10)},onMoveUp:()=>{l>0&&c(l,l-1)},onMoveDown:()=>{l<t.blocks.length-1&&c(l,l+1)},textareaRef:e=>d.current[l]=e,isSelected:x===e.id}),(0,s.jsx)("div",{className:"flex justify-center my-1 group",children:(0,s.jsx)("button",{className:"hidden group-hover:inline-block px-2 py-1 bg-primary text-primary-foreground rounded text-xs",onClick:()=>v(l+1),children:"＋ト書きを追加"})})]},e.id))})})})}),(0,s.jsx)("button",{onClick:n,className:"fixed right-6 z-40 px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-full shadow-lg transition-all text-lg ".concat(0===t.blocks.length?"bottom-1/2 transform translate-y-1/2":"bottom-6"),title:"Ctrl+B:新規ブロックを追加",children:"＋ブロックを追加"})]})}function E(e){let{isOpen:t,onClose:r,onConfirm:n,existingProjects:o}=e,[a,c]=(0,l.useState)(""),[i,d]=(0,l.useState)(""),u=()=>{c(""),d(""),r()};return t?(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"新しいプロジェクト"}),(0,s.jsx)("button",{onClick:u,className:"p-1 hover:bg-accent rounded transition-colors",children:(0,s.jsx)(f.Z,{className:"w-5 h-5 text-foreground"})})]}),(0,s.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!a.trim()){d("プロジェクト名を入力してください");return}if(o.includes(a.trim())){d("同名のプロジェクトが既に存在します");return}n(a.trim()),c(""),d(""),r()},className:"p-4 space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"projectName",className:"block text-sm font-medium text-foreground mb-2",children:"プロジェクト名"}),(0,s.jsx)("input",{type:"text",id:"projectName",value:a,onChange:e=>{c(e.target.value),d("")},className:"w-full p-2 border rounded bg-background text-foreground focus:ring-2 focus:ring-ring focus:outline-none",placeholder:"プロジェクト名を入力",autoFocus:!0}),i&&(0,s.jsx)("p",{className:"text-sm text-destructive mt-1",children:i})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,s.jsx)("button",{type:"button",onClick:u,className:"px-4 py-2 text-sm text-muted-foreground hover:bg-accent rounded transition-colors",children:"キャンセル"}),(0,s.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 transition-colors",children:"作成"})]})]})]})}):null}function U(){let[e,t]=(0,l.useState)([]),[r,n]=(0,l.useState)([]),[o,a]=(0,l.useState)("default"),[c,i]=(0,l.useState)([]),[d,u]=(0,l.useState)([]),[m,x]=(0,l.useState)([]),[p,h]=(0,l.useState)({id:"1",title:"新しい台本",blocks:[]}),[f,g]=(0,l.useState)(""),[v,b]=(0,l.useState)(!1),y=(e,t)=>{if(""===f)localStorage.setItem(e,t);else if(window.electronAPI){var r;null===(r=window.electronAPI)||void 0===r||r.saveData(e,t)}},N=async e=>{if(""===f)return localStorage.getItem(e);if(window.electronAPI){var t;return await (null===(t=window.electronAPI)||void 0===t?void 0:t.loadData(e))||null}return null};(0,l.useEffect)(()=>{(async()=>{var e,r;let s="";if(window.electronAPI)try{s=(await window.electronAPI.loadSettings()).saveDirectory||"",g(s)}catch(e){console.error("設定読み込みエラー:",e)}else g(s=localStorage.getItem("voiscripter_saveDirectory")||"");let l=await N("voiscripter_characters");l&&t(JSON.parse(l).map(e=>({...e,group:e.group||"なし"})));let o=await N("voiscripter_groups");if(o)try{let e=JSON.parse(o);Array.isArray(e)?n(e):(console.warn("Invalid groups data format:",e),n([]))}catch(e){console.error("Groups parse error:",e),n([])}else{let e=await N("voiscripter_characters");if(e)try{let t=JSON.parse(e).map(e=>e.group||"なし").filter(e=>"なし"!==e).filter((e,t,r)=>r.indexOf(e)===t);n(t)}catch(e){console.error("Failed to extract groups from characters:",e),n([])}else n([])}let c=await N("voiscripter_lastProject"),d="default";c&&"lastProject"!==c&&(d=c),a(d),""===s?i(Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_",""))):window.electronAPI&&i((await (null===(e=window.electronAPI)||void 0===e?void 0:e.listDataKeys())||[]).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_","")));let m=await N("voiscripter_".concat(d));if(m)try{h(JSON.parse(m))}catch(e){console.error("Script parse error:",e),h({id:"1",title:"新しい台本",blocks:[]})}else"default"===d&&window.electronAPI&&await (null===(r=window.electronAPI)||void 0===r?void 0:r.initializeDefaultProject()),h({id:"1",title:"新しい台本",blocks:[]});let p=await N("voiscripter_".concat(d,"_undo"));if(p)try{u(JSON.parse(p))}catch(e){console.error("Undo stack parse error:",e),u([])}let f=await N("voiscripter_".concat(d,"_redo"));if(f)try{x(JSON.parse(f))}catch(e){console.error("Redo stack parse error:",e),x([])}})()},[]);let w=(0,l.useRef)(!0);(0,l.useEffect)(()=>{if(w.current){w.current=!1;return}y("voiscripter_characters",JSON.stringify(e))},[e,f]),(0,l.useEffect)(()=>{(r.length>0||localStorage.getItem("voiscripter_groups"))&&y("voiscripter_groups",JSON.stringify(r))},[r,f]),(0,l.useEffect)(()=>{y("voiscripter_lastProject",o),(async()=>{let e=await N("voiscripter_".concat(o));h(e?JSON.parse(e):{id:"1",title:"新しい台本",blocks:[]});let t=await N("voiscripter_".concat(o,"_undo"));u(t?JSON.parse(t):[]);let r=await N("voiscripter_".concat(o,"_redo"));if(x(r?JSON.parse(r):[]),""===f)i(Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_","")));else if(window.electronAPI){var s;i((await (null===(s=window.electronAPI)||void 0===s?void 0:s.listDataKeys())||[]).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_","")))}})()},[o,f]);let k=(0,l.useRef)(!0);(0,l.useEffect)(()=>{if(k.current){k.current=!1;return}if(u(e=>{let t=[...e,p];return y("voiscripter_".concat(o,"_undo"),JSON.stringify(t)),t}),x([]),""===f)localStorage.removeItem("voiscripter_".concat(o,"_redo"));else if(window.electronAPI){var e;null===(e=window.electronAPI)||void 0===e||e.saveData("voiscripter_".concat(o,"_redo"),"")}y("voiscripter_".concat(o),JSON.stringify(p))},[p,o,f]),(0,l.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"z"===e.key.toLowerCase()){if(e.preventDefault(),d.length>0){x(e=>{let t=[p,...e];return y("voiscripter_".concat(o,"_redo"),JSON.stringify(t)),t});let e=d[d.length-1];u(e=>{let t=e.slice(0,-1);return y("voiscripter_".concat(o,"_undo"),JSON.stringify(t)),t}),h(e)}}else if(e.ctrlKey&&"y"===e.key.toLowerCase()&&(e.preventDefault(),m.length>0)){let e=m[0];u(e=>{let t=[...e,p];return y("voiscripter_".concat(o,"_undo"),JSON.stringify(t)),t}),x(e=>{let t=e.slice(1);return y("voiscripter_".concat(o,"_redo"),JSON.stringify(t)),t}),h(e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,m,p,o,f]);let[S,C]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,r="dark"===e||!e&&t;C(r),document.documentElement.classList.toggle("dark",r)};e();let t=window.matchMedia("(prefers-color-scheme: dark)"),r=()=>{localStorage.getItem("theme")||e()};return t.addEventListener("change",r),()=>{t.removeEventListener("change",r)}},[]);let _=async e=>{var t,r,s;if(g(e),localStorage.setItem("voiscripter_saveDirectory",e),""!==e&&""===f){if(window.electronAPI)for(let e of Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_"))){let r=localStorage.getItem(e);r&&await (null===(t=window.electronAPI)||void 0===t?void 0:t.saveData(e,r))}}else if(""===e&&""!==f&&window.electronAPI)for(let e of await (null===(r=window.electronAPI)||void 0===r?void 0:r.listDataKeys())||[]){let t=await (null===(s=window.electronAPI)||void 0===s?void 0:s.loadData(e));t&&localStorage.setItem(e,t)}},I=async t=>{try{let r=(await t.text()).split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>{let t=[],r="",s=!1;for(let l=0;l<e.length;l++){let n=e[l];'"'===n?s&&'"'===e[l+1]?(r+='"',l++):s=!s:","!==n||s?r+=n:(t.push(r.trim()),r="")}return t.push(r.trim()),t}).slice(1).filter(e=>e.length>=2&&(e[0]||e[1])).map(t=>{let[r,s]=t,l=e.find(e=>e.name===r);return l?{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:l.id,emotion:"normal",text:s||""}:{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:"【".concat(r,"】").concat(s||"")}});h(e=>({...e,blocks:[...e.blocks,...r]})),alert("".concat(r.length,"個のブロックをインポートしました。"))}catch(e){console.error("CSVインポートエラー:",e),alert("CSVファイルのインポートに失敗しました。")}},U=async e=>{try{let r=(await e.text()).split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>{let t=[],r="",s=!1;for(let l=0;l<e.length;l++){let n=e[l];'"'===n?s&&'"'===e[l+1]?(r+='"',l++):s=!s:","!==n||s?r+=n:(t.push(r.trim()),r="")}return t.push(r.trim()),t}).slice(1).filter(e=>e.length>=1&&""!==e[0].trim()).map(e=>{let[t,r]=e;return{id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:t,group:"なし",emotions:{normal:{iconUrl:r||""}}}});t(e=>[...e,...r]),alert("".concat(r.length,"個のキャラクターをインポートしました。"))}catch(e){console.error("キャラクター設定のCSVインポートエラー:",e),alert("キャラクター設定のCSVファイルのインポートに失敗しました。")}};return(0,s.jsxs)("div",{id:"root",children:[(0,s.jsxs)("div",{className:"min-h-screen bg-background text-foreground transition-colors duration-300",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[(0,s.jsx)("label",{children:"プロジェクト: "}),(0,s.jsx)("select",{value:o,onChange:e=>a(e.target.value),className:"border rounded p-1",children:c.map(e=>(0,s.jsx)("option",{value:e,children:e},e))}),(0,s.jsx)("button",{onClick:()=>{b(!0)},className:"px-2 py-1 bg-primary text-primary-foreground rounded",children:"新規作成"}),"default"!==o&&(0,s.jsx)("button",{onClick:()=>{if("default"===o){alert("デフォルトプロジェクトは削除できません");return}if(confirm("プロジェクト「".concat(o,"」を削除しますか？\nこの操作は元に戻せません。"))){if(""===f)localStorage.removeItem("voiscripter_".concat(o)),localStorage.removeItem("voiscripter_".concat(o,"_undo")),localStorage.removeItem("voiscripter_".concat(o,"_redo"));else if(window.electronAPI){var e,t,r;null===(e=window.electronAPI)||void 0===e||e.saveData("voiscripter_".concat(o),""),null===(t=window.electronAPI)||void 0===t||t.saveData("voiscripter_".concat(o,"_undo"),""),null===(r=window.electronAPI)||void 0===r||r.saveData("voiscripter_".concat(o,"_redo"),"")}i(e=>e.filter(e=>e!==o)),a("default"),h({id:"1",title:"新しい台本",blocks:[]}),u([]),x([])}},className:"px-2 py-1 bg-destructive text-destructive-foreground rounded",children:"削除"})]}),(0,s.jsx)(j,{characters:e,onAddCharacter:e=>{t(t=>[...t,e])},onUpdateCharacter:e=>{t(t=>t.map(t=>t.id===e.id?e:t))},onDeleteCharacter:e=>{t(t=>t.filter(t=>t.id!==e)),h(t=>({...t,blocks:t.blocks.map(t=>t.characterId===e?{...t,characterId:""}:t)}))},onThemeChange:e=>{C(e),localStorage.setItem("theme",e?"dark":"light"),document.documentElement.classList.toggle("dark",e)},onExportCSV:()=>{let t=p.blocks.filter(e=>e.characterId).map(t=>{let r=e.find(e=>e.id===t.characterId);return[r?r.name:"",t.text]}).map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),l=document.createElement("a");l.href=s,l.download="".concat(p.title||"script",".csv"),l.click(),URL.revokeObjectURL(s)},onExportSerifOnly:()=>{let e=p.blocks.filter(e=>e.characterId).map(e=>[e.text]).map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download="".concat(p.title||"serif",".csv"),s.click(),URL.revokeObjectURL(r)},onExportCharacterCSV:()=>{let t=[["名前","アイコン"],...e.map(e=>[e.name,e.emotions.normal.iconUrl])].map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r),l=document.createElement("a");l.href=s,l.download="characters.csv",l.click(),URL.revokeObjectURL(s)},onExportByGroups:(t,r)=>{t.forEach(t=>{let s,l;let n=e.filter(e=>e.group===t).map(e=>e.id),o=p.blocks.filter(e=>e.characterId&&n.includes(e.characterId));if(0===o.length){console.log("グループ「".concat(t,"」にはセリフがありません"));return}"full"===r?(s=o.map(t=>{let r=e.find(e=>e.id===t.characterId);return[r?r.name:"",t.text]}),l="".concat(p.title||"script","_").concat(t,".csv")):(s=o.map(e=>[e.text]),l="".concat(p.title||"serif","_").concat(t,".csv"));let a=s.map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),c=new Blob([a],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(c),d=document.createElement("a");d.href=i,d.download=l,d.click(),URL.revokeObjectURL(i)})},onImportCSV:I,onImportCharacterCSV:U,isDarkMode:S,saveDirectory:f,onSaveDirectoryChange:_,groups:r,onAddGroup:e=>{n(t=>[...t,e])},onDeleteGroup:e=>{n(t=>t.filter(t=>t!==e)),t(t=>t.map(t=>t.group===e?{...t,group:"なし"}:t))}}),(0,s.jsx)("main",{className:"p-4",children:(0,s.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,s.jsx)(D,{script:{...p,characters:e},onUpdateBlock:(e,t)=>{h(r=>({...r,blocks:r.blocks.map(r=>r.id===e?{...r,...t}:r)}))},onAddBlock:()=>{var t;let r=[...p.blocks].reverse().find(e=>e.characterId),s=(null==r?void 0:r.characterId)||(null===(t=e[0])||void 0===t?void 0:t.id)||"",l=(null==r?void 0:r.emotion)||"normal",n={id:Date.now().toString(),characterId:s,emotion:l,text:""};h(e=>({...e,blocks:[...e.blocks,n]}))},onDeleteBlock:e=>{h(t=>({...t,blocks:t.blocks.filter(t=>t.id!==e)}))},onInsertBlock:(e,t)=>{h(r=>{let s=[...r.blocks];return s.splice(t,0,e),{...r,blocks:s}})},onMoveBlock:(e,t)=>{h(r=>{let s=[...r.blocks],[l]=s.splice(e,1);return s.splice(t,0,l),{...r,blocks:s}})}})})})]}),(0,s.jsx)(E,{isOpen:v,onClose:()=>b(!1),onConfirm:e=>{a(e),i(t=>[...t,e]),y("voiscripter_".concat(e),JSON.stringify({id:"1",title:e,blocks:[]})),y("voiscripter_lastProject",e)},existingProjects:c})]})}}},function(e){e.O(0,[59,971,69,744],function(){return e(e.s=382)}),_N_E=e.O()}]);