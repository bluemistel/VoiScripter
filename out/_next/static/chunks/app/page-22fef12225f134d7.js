(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{382:function(e,t,r){Promise.resolve().then(r.bind(r,2110))},2110:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return B}});var l=r(3827),s=r(4090),n=r(5548),o=r(954),c=r(5061),i=r(9812),a=r(8096),d=r(4710),u=r(4102),m=r(4424),x=r(1310),h=r(7135),p=r(4048),f=r(1216);let g={normal:{iconUrl:""}};function b(e){let{character:t,isEditing:r,children:s,...n}=e,{attributes:o,listeners:c,setNodeRef:i,transform:a,transition:d,isDragging:u}=(0,p.nB)({id:t.id}),m={transform:f.ux.Transform.toString(a),transition:d,opacity:u?.5:1};return(0,l.jsxs)("div",{ref:i,style:m,className:"border rounded p-3 flex items-center justify-items-start bg-background",children:[(0,l.jsx)("div",{...o,...c,className:"cursor-grab mr-2 select-none",children:(0,l.jsxs)("svg",{width:"20",height:"20",fill:"none",children:[(0,l.jsx)("rect",{width:"4",height:"4",x:"2",y:"2",rx:"1",fill:"#888"}),(0,l.jsx)("rect",{width:"4",height:"4",x:"2",y:"10",rx:"1",fill:"#888"}),(0,l.jsx)("rect",{width:"4",height:"4",x:"10",y:"2",rx:"1",fill:"#888"}),(0,l.jsx)("rect",{width:"4",height:"4",x:"10",y:"10",rx:"1",fill:"#888"})]})}),s]})}function v(e){let{group:t,children:r,...s}=e,{attributes:n,listeners:o,setNodeRef:c,transform:i,transition:a,isDragging:d}=(0,p.nB)({id:"".concat(t,"-").concat(s.index||0)}),u={transform:f.ux.Transform.toString(i),transition:a,opacity:d?.5:1};return(0,l.jsxs)("div",{ref:c,style:u,className:"flex items-center justify-between p-2 border rounded bg-muted/30 mb-1",children:[(0,l.jsx)("div",{...n,...o,className:"cursor-grab mr-2 select-none",children:(0,l.jsxs)("svg",{width:"16",height:"16",fill:"none",children:[(0,l.jsx)("rect",{width:"3",height:"3",x:"1",y:"1",rx:"1",fill:"#888"}),(0,l.jsx)("rect",{width:"3",height:"3",x:"1",y:"7",rx:"1",fill:"#888"}),(0,l.jsx)("rect",{width:"3",height:"3",x:"7",y:"1",rx:"1",fill:"#888"}),(0,l.jsx)("rect",{width:"3",height:"3",x:"7",y:"7",rx:"1",fill:"#888"})]})}),r]})}function j(e){var t,r;let{characters:o,onAddCharacter:c,onUpdateCharacter:i,onDeleteCharacter:a,groups:d,onAddGroup:f,onDeleteGroup:j,onReorderCharacters:y,onReorderGroups:w}=e,[N,k]=(0,s.useState)(!1),[S,C]=(0,s.useState)(null),[I,_]=(0,s.useState)(!1),[E,D]=(0,s.useState)(""),[A,T]=(0,s.useState)({name:"",group:"なし",emotions:{...g}}),[P,L]=(0,s.useState)(null),[U,R]=(0,s.useState)(null),[O,B]=(0,s.useState)("#e5e7eb"),V=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!l)return;let s=new FileReader;s.onload=()=>{r?L(e=>({...null!=e?e:{},emotions:{normal:{iconUrl:s.result}}})):T(e=>({...e,emotions:{normal:{iconUrl:s.result}}}))},s.readAsDataURL(l)},Z=(e,t)=>{let r=o.find(t=>t.id===e);r&&i({...r,backgroundColor:t})},M=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#e5e7eb";R(e),B(t)},K=e=>{if(e.preventDefault(),P&&P.name){var t,r;i({id:P.id,name:P.name,group:P.group||"なし",emotions:{normal:{iconUrl:(null===(r=P.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||""}},backgroundColor:P.backgroundColor||"#e5e7eb"}),C(null),L(null)}},J=(0,h.Dy)((0,h.VT)(h.we)),F=(0,h.Dy)((0,h.VT)(h.we));return(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)(h.LB,{sensors:J,collisionDetection:h.pE,onDragEnd:e=>{if(!y)return;let{active:t,over:r}=e;if(r&&t.id!==r.id){let e=o.findIndex(e=>e.id===t.id),l=o.findIndex(e=>e.id===r.id);if(-1!==e&&-1!==l){let t=[...o],[r]=t.splice(e,1);t.splice(l,0,r),y(t)}}},children:(0,l.jsx)(p.Fo,{items:o.map(e=>e.id),strategy:p.U2,children:(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:o.map(e=>{var t,r;return(0,l.jsx)(b,{character:e,isEditing:S===e.id,children:S===e.id?(0,l.jsxs)("form",{onSubmit:K,className:"flex-1 space-y-2",children:[(0,l.jsx)("input",{type:"text",value:(null==P?void 0:P.name)||"",onChange:e=>L(t=>({...null!=t?t:{},name:e.target.value})),placeholder:"キャラクター名",className:"w-full p-2 border rounded bg-background text-foreground",required:!0}),(0,l.jsxs)("select",{value:(null==P?void 0:P.group)||"なし",onChange:e=>L(t=>({...null!=t?t:{},group:e.target.value})),className:"w-full p-2 border rounded bg-background text-foreground",children:[(0,l.jsx)("option",{value:"なし",children:"なし"}),d.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("input",{type:"text",value:(null==P?void 0:null===(r=P.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||"",onChange:e=>L(t=>({...null!=t?t:{},emotions:{normal:{iconUrl:e.target.value}}})),placeholder:"アイコンURLまたは画像を選択",className:"flex-1 p-2 border rounded bg-background text-foreground"}),(0,l.jsxs)("label",{className:"cursor-pointer bg-primary text-primary-foreground px-3 py-1 rounded text-xs hover:bg-primary/90 transition-colors",children:["ファイルを選択",(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>V(e,!0),className:"hidden"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>{C(null),L(null)},className:"px-3 py-1 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"保存"})]})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 md:mt-0",children:[(0,l.jsx)("div",{className:"flex items-center space-x-1",children:e.emotions.normal.iconUrl?(0,l.jsx)("img",{src:e.emotions.normal.iconUrl,alt:e.name,className:"w-14 h-14 rounded-full border object-cover"}):(0,l.jsxs)("div",{className:"relative w-14 h-14 rounded-full border flex items-center justify-center text-center overflow-hidden group",style:{backgroundColor:e.backgroundColor||"#e5e7eb"},children:[(0,l.jsx)("span",{className:"text-xs font-bold text-foreground px-1 max-w-[80px] whitespace-no-wrap overflow-hidden".concat(e.name.length>8?" text-ellipsis":""),style:{textShadow:"\n                                      -1px -1px 0 var(--color-background),  \n                                       1px -1px 0 var(--color-background),\n                                      -1px  1px 0 var(--color-background),\n                                       1px  1px 0 var(--color-background)\n                                    "},children:e.name.length>8?e.name.slice(0,8)+"…":e.name}),(0,l.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,l.jsx)("button",{onClick:()=>M(e.id,e.backgroundColor||"#e5e7eb"),className:"p-1 bg-white rounded-full shadow-lg hover:bg-gray-100 transition-colors",children:(0,l.jsx)(n.Z,{className:"w-3 h-3 text-gray-700"})})})]})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-semibold text-foreground ",children:e.name}),(0,l.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["グループ: ",e.group||"なし"]})]})]})}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 ml-auto items-end",children:[(0,l.jsxs)("button",{onClick:()=>{C(e.id),L({...e})},className:"p-2 text-destructive hover:bg-destructive/10 rounded flex items-center",children:[(0,l.jsx)(n.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"ml-1 text-xs",children:"編集"})]}),(0,l.jsxs)("button",{onClick:()=>a(e.id),className:"p-2 text-destructive hover:bg-destructive/10 rounded flex items-center",children:[(0,l.jsx)(m.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{className:"ml-1 text-xs",children:"削除"})]})]})]})},e.id)})})})}),N?(0,l.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),A.name){var t,r;c({id:Date.now().toString(),name:A.name,group:A.group||"なし",emotions:{normal:{iconUrl:(null===(r=A.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||""}},backgroundColor:"#e5e7eb"}),T({name:"",group:"なし",emotions:{...g}}),k(!1)}},className:"border rounded p-3 space-y-3 bg-background",children:[(0,l.jsx)("input",{type:"text",value:A.name,onChange:e=>T(t=>({...t,name:e.target.value})),placeholder:"キャラクター名",className:"w-full p-2 border rounded bg-background text-foreground",required:!0}),(0,l.jsxs)("select",{value:A.group||"なし",onChange:e=>T(t=>({...t,group:e.target.value})),className:"w-full p-2 border rounded bg-background text-foreground",children:[(0,l.jsx)("option",{value:"なし",children:"なし"}),d.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("input",{type:"text",value:(null===(r=A.emotions)||void 0===r?void 0:null===(t=r.normal)||void 0===t?void 0:t.iconUrl)||"",onChange:e=>T(t=>({...t,emotions:{normal:{iconUrl:e.target.value}}})),placeholder:"アイコンURLまたは画像を選択",className:"flex-1 p-2 border rounded text-foreground"}),(0,l.jsxs)("label",{className:"cursor-pointer bg-primary text-primary-foreground px-3 py-1 rounded text-xs hover:bg-primary/90 transition-colors",children:["ファイルを選択",(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>V(e,!1),className:"hidden"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:()=>k(!1),className:"px-3 py-1 text-sm text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,l.jsx)("button",{type:"submit",className:"px-3 py-1 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"追加"})]})]}):(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsxs)("button",{onClick:()=>_(!0),className:"flex-1 flex items-center justify-center space-x-2 p-2 border rounded hover:bg-accent text-foreground",style:{flex:"0 0 33.333%",backgroundColor:"var(--color-secondary)",color:"var(--color-secondary-foreground)"},children:[(0,l.jsx)(u.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"グループ設定"})]}),(0,l.jsxs)("button",{onClick:()=>k(!0),className:"flex-1 flex items-center justify-center space-x-2 p-2 border rounded hover:bg-accent text-foreground",style:{backgroundColor:"var(--color-primary)",color:"var(--color-primary-foreground)"},children:[(0,l.jsx)(x.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"キャラクターを追加"})]})]}),I&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4 p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"グループ設定"}),(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("input",{type:"text",value:E,onChange:e=>D(e.target.value),placeholder:"新しいグループ名",className:"flex-1 p-2 border rounded bg-background text-foreground"}),(0,l.jsx)("button",{onClick:()=>{E.trim()&&!d.includes(E.trim())&&(f(E.trim()),D(""))},className:"px-3 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"追加"})]})}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("h4",{className:"font-medium text-foreground",children:"既存のグループ"}),0===d.length?(0,l.jsx)("p",{className:"text-muted-foreground text-sm",children:"グループがありません"}):(0,l.jsx)(h.LB,{sensors:F,collisionDetection:h.pE,onDragEnd:e=>{if(!w)return;let{active:t,over:r}=e;if(r&&t.id!==r.id){let e=d.findIndex(e=>e===t.id),l=d.findIndex(e=>e===r.id);if(-1!==e&&-1!==l){let t=[...d],[r]=t.splice(e,1);t.splice(l,0,r),w(t)}}},children:(0,l.jsx)(p.Fo,{items:d.map((e,t)=>"".concat(e,"-").concat(t)),strategy:p.U2,children:d.map((e,t)=>(0,l.jsxs)(v,{group:e,index:t,children:[(0,l.jsx)("span",{className:"text-foreground",children:e}),(0,l.jsx)("button",{onClick:()=>j(e),className:"p-1 text-destructive hover:bg-destructive/10 rounded",children:(0,l.jsx)(m.Z,{className:"w-4 h-4"})})]},"".concat(e,"-").concat(t)))})})]}),(0,l.jsx)("div",{className:"flex justify-end mt-6",children:(0,l.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"閉じる"})})]})}),U&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-sm mx-4 p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"背景色を選択"}),(0,l.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,l.jsx)("input",{type:"color",value:O,onChange:e=>B(e.target.value),className:"w-32 h-32 cursor-pointer"}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("button",{onClick:()=>{U&&(Z(U,O),R(null))},className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90",children:"適用"}),(0,l.jsx)("button",{onClick:()=>R(null),className:"px-4 py-2 bg-muted text-muted-foreground rounded hover:bg-muted/80",children:"キャンセル"})]})]})]})})]})}var y=r(8621),w=r(9097),N=r(3371),k=r(7474);function S(e){let{isOpen:t,onClose:r,saveDirectory:n,onSaveDirectoryChange:o}=e,[c,i]=(0,s.useState)("settings"),[a,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)(()=>localStorage.getItem("fontFamily")||"mplus");(0,s.useEffect)(()=>{localStorage.setItem("fontFamily",m),document.body.classList.remove("font-mplus","font-noto","font-sawarabi"),document.body.classList.add("font-".concat(m))},[m]);let h=async()=>{if(!window.electronAPI){alert("この機能はデスクトップアプリ版でのみ利用できます(開発中)");return}d(!0);try{let e=await window.electronAPI.selectDirectory();e&&o(e)}catch(e){console.error("ディレクトリ選択エラー:",e)}finally{d(!1)}};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-3xl mx-4 h-[750px] overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"設定"}),(0,l.jsx)("button",{onClick:r,className:"p-1 hover:bg-accent rounded transition-colors",children:(0,l.jsx)(y.Z,{className:"w-5 h-5 text-foreground"})})]}),(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsxs)("div",{className:"w-48 border-r bg-muted/30 h-[750px]",children:[(0,l.jsxs)("button",{onClick:()=>i("settings"),className:"w-full p-3 text-left flex items-center space-x-2 transition-colors ".concat("settings"===c?"bg-primary text-primary-foreground":"hover:bg-accent"),children:[(0,l.jsx)(u.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"設定"})]}),(0,l.jsxs)("button",{onClick:()=>i("help"),className:"w-full p-3 text-left flex items-center space-x-2 transition-colors ".concat("help"===c?"bg-primary text-primary-foreground":"hover:bg-accent"),children:[(0,l.jsx)(w.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"ヘルプ"})]}),(0,l.jsxs)("button",{onClick:()=>i("changelog"),className:"w-full p-3 text-left flex items-center space-x-2 transition-colors ".concat("changelog"===c?"bg-primary text-primary-foreground":"hover:bg-accent"),children:[(0,l.jsx)(N.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"更新履歴"})]}),(0,l.jsxs)("button",{onClick:()=>i("license"),className:"w-full p-3 text-left flex items-center space-x-2 transition-colors ".concat("license"===c?"bg-primary text-primary-foreground":"hover:bg-accent"),children:[(0,l.jsx)(k.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"ライセンス"})]})]}),(0,l.jsxs)("div",{className:"flex-1 p-6 overflow-y-auto",children:["settings"===c&&(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-foreground mb-4",children:"フォント"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"表示フォント"}),(0,l.jsxs)("select",{className:"p-2 border rounded bg-background text-foreground",value:m,onChange:e=>x(e.target.value),children:[(0,l.jsx)("option",{value:"mplus",children:"M PLUS 1p（デフォルト）"}),(0,l.jsx)("option",{value:"noto",children:"Noto Sans JP"}),(0,l.jsx)("option",{value:"sawarabi",children:"Sawarabi Gothic"})]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-foreground mb-4",children:"データの保存先"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"現在の保存先"}),(0,l.jsx)("div",{className:"p-3 bg-muted rounded border",children:n||"localStorage（ブラウザ）"})]}),(0,l.jsxs)("div",{className:"flex space-x-2",children:[(0,l.jsx)("button",{onClick:h,disabled:a,className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 disabled:opacity-50 transition-colors",children:a?"選択中...":"ディレクトリを選択"}),n&&(0,l.jsx)("button",{onClick:()=>{o("")},className:"px-4 py-2 bg-destructive text-destructive-foreground rounded hover:bg-destructive/90 transition-colors",children:"localStorageに戻す"})]}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground",children:[(0,l.jsx)("p",{children:"• ディレクトリを選択すると、データがファイルとして保存されます"}),(0,l.jsx)("p",{children:"• 保存先を変更すると、既存のデータが自動的に移動されます"}),(0,l.jsx)("p",{children:"• 未設定の場合はlocalStorageに保存されます"})]})]})]})]}),"help"===c&&(0,l.jsxs)("div",{className:"flex flex-col max-h-[60vh] overflow-y-auto pr-2",children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"VoiScripter ヘルプ"}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"基本的な使い方"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsx)("li",{children:"• 右上のキャラクターのアイコンから話者を追加してください。"}),(0,l.jsx)("li",{children:"• Alt+↑ ↓、またはキャラクターを変更してセリフを入力してください。"}),(0,l.jsx)("li",{children:"• Ctrl+Enter、または「＋ブロックを追加」ボタンでセリフを追加できます。"}),(0,l.jsx)("li",{children:"• Ctrl+↑ ↓、またはドラッグ&ドロップでブロックの順序を変更できます。"}),(0,l.jsx)("li",{children:"• 右上のエクスポートからCSVのテキストファイルとして出力できます。"}),(0,l.jsx)("li",{children:"• エクスポートしたファイルは、VoiScripterでも読み込むことができます。"}),(0,l.jsx)("li",{children:"• 作業状態は随時保存されており、閉じても前回の状態から再開できます。"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"キーボードショートカット"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Z"})," 元に戻す"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Y"})," やり直し"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Enter"})," 直下に新規ブロック追加"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+B"})," 最下段に新規ブロック追加"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Alt+B"})," ト書きブロックを追加"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Alt+B"}),"選択ブロック削除"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+↑/↓"})," ブロック移動"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Alt+↑/↓"})," キャラクターを選択"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+M"})," CSVエクスポートダイアログを開く"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+,"})," 最下段へ移動する"]}),(0,l.jsxs)("li",{children:["• ",(0,l.jsx)("kbd",{className:"px-1 py-0.5 bg-muted rounded text-xs",children:"Ctrl+Alt+,"})," 最上段へ移動する"]})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"プロジェクト管理"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsx)("li",{children:"• 複数のプロジェクトを作成・管理できます。"}),(0,l.jsx)("li",{children:"• プロジェクトは自動的に保存されます。"}),(0,l.jsx)("li",{children:"• 設定でデータの保存先を変更できます。"})]})]})]})]}),"changelog"===c&&(0,l.jsxs)("div",{className:"flex flex-col max-h-[60vh] overflow-y-auto pr-2",children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-4",children:"更新履歴"}),(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"v0.1.3"}),(0,l.jsx)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:(0,l.jsxs)("li",{children:["• キャラクターアイコンの背景色をカラーピッカーで変更できる機能を追加",(0,l.jsx)("br",{}),"キャラクター管理画面でアイコンにホバーするとペンアイコンが表示されます"]})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"v0.1.2"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsxs)("li",{children:["• マウス操作によるテキストブロックの複数選択機能を追加。",(0,l.jsx)("br",{}),"Ctrl+クリック、Shift+クリックでブロックを複数選択できます"]}),(0,l.jsx)("li",{children:"• CSVエクスポートダイアログをタブ形式に変更（台本/キャラクター設定）キャラクター設定は別デバイスへの引き継ぎ用に使用できます"}),(0,l.jsx)("li",{children:"• エクスポート機能に「選択ブロックのみエクスポート」を追加"}),(0,l.jsx)("li",{children:"• エクスポート機能に「クリップボードへの出力」を追加"}),(0,l.jsx)("li",{children:"• グループごとにエクスポート機能を改善（全選択/部分選択UI）"}),(0,l.jsx)("li",{children:"• キャラクター設定のエクスポート/インポートにグループ設定を反映"}),(0,l.jsx)("li",{children:"• キャラクター設定のインポート時に重複チェック機能を追加"}),(0,l.jsx)("li",{children:"• キャラクター設定のインポート時に新しいグループの自動追加機能を追加"}),(0,l.jsx)("li",{children:"• CSVインポート時に台本またはキャラクター設定のインポートかを判定するように変更"}),(0,l.jsx)("li",{children:"• 無効なデータのインポート時のエラー処理を追加"}),(0,l.jsx)("li",{children:"• localStorageの容量(5MB)を超過した際のエラー処理を改善"}),(0,l.jsx)("li",{children:"• ショートカット(Ctrl+M)を追加。CSVエクスポートダイアログを直接開きます"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"v0.1.1"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsx)("li",{children:"• スクロール位置の補正機能を改善"}),(0,l.jsx)("li",{children:"• テキストブロックの挿入時のフォーカス処理を修正"}),(0,l.jsx)("li",{children:"• キーボードショートカットの動作を最適化"}),(0,l.jsx)("li",{children:"• 設定画面に更新履歴タブを追加"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"v0.1.0"}),(0,l.jsxs)("ul",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsx)("li",{children:"• 初回リリース"}),(0,l.jsx)("li",{children:"• 基本的なテキストブロック編集機能"}),(0,l.jsx)("li",{children:"• キャラクター管理機能"}),(0,l.jsx)("li",{children:"• CSVエクスポート/インポート機能"}),(0,l.jsx)("li",{children:"• プロジェクト管理機能"}),(0,l.jsx)("li",{children:"• ドラッグ&ドロップによるブロック並び替え"}),(0,l.jsx)("li",{children:"• キーボードショートカット対応"}),(0,l.jsx)("li",{children:"• ダークモード対応"}),(0,l.jsx)("li",{children:"• デスクトップアプリ対応(開発中)"})]})]})]})]}),"license"===c&&(0,l.jsxs)("div",{className:"mt-6",children:[(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"このアプリについて"}),(0,l.jsxs)("div",{className:"text-sm text-muted-foreground space-y-1 ml-4",children:[(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsx)("span",{className:"font-bold text-foreground",children:"VoiScripter"})}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)("span",{children:"本アプリの不具合により何らかの損害が発生した場合でも、作者は一切の責任を負いません。自己責任でのご使用をお願いいたします。"})}),(0,l.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"使用技術"}),(0,l.jsx)("div",{className:"mb-2",children:(0,l.jsxs)("ul",{className:"list-disc ml-6",children:[(0,l.jsx)("li",{children:"Next.js (MIT)"}),(0,l.jsx)("li",{children:"React (MIT)"}),(0,l.jsx)("li",{children:"TypeScript (Apache-2.0)"}),(0,l.jsx)("li",{children:"Tailwind CSS (MIT)"}),(0,l.jsx)("li",{children:"@dnd-kit/core, @dnd-kit/sortable (MIT)"}),(0,l.jsx)("li",{children:"Heroicons (MIT)"}),(0,l.jsx)("li",{children:"Electron (MIT)"})]})}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("span",{className:"font-semibold text-foreground",children:"ライセンス:"}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)("span",{children:"本アプリおよび上記ライブラリはMITまたはApache-2.0ライセンスに基づき配布されています。"})})]}),(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)("span",{className:"font-semibold text-foreground",children:"Copyright:"}),(0,l.jsx)("div",{className:"ml-2",children:(0,l.jsx)("span",{children:"\xa9 2025 VoiScripter Authors"})})]})]})]})]})]})]})}):null}function C(e){let{isOpen:t,onClose:r,characters:n,groups:o,selectedBlockIds:c,onExportCSV:i,onExportSerifOnly:a,onExportByGroups:d,onExportCharacterCSV:u,onExportToClipboard:m}=e,[x,h]=(0,s.useState)("full"),[p,f]=(0,s.useState)([]),[g,b]=(0,s.useState)(!1),[v,j]=(0,s.useState)(!1),[y,w]=(0,s.useState)(!1),[N,k]=(0,s.useState)(!1),[S,C]=(0,s.useState)("script");(0,s.useEffect)(()=>{"character-setting"===x&&(j(!1),w(!1),k(!1))},[x]),(0,s.useEffect)(()=>{0===c.length&&w(!1)},[c]),(0,s.useEffect)(()=>{g&&0===p.length&&f([...o])},[g,o]);let I=()=>0!==p.length&&(p.length===o.length||"indeterminate");(0,s.useEffect)(()=>{"character"===S?h("character-setting"):h("full")},[S]);let _=e=>{f(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},E=(e,t)=>{N?m("serif-only"===e,y,t):g&&p.length>0?d(p,e,t,y):g||("full"===e?i(t,y):a(y)),r()},D=()=>{f([]),b(!1),h("full"),w(!1),k(!1),C("script"),r()};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 transition-opacity duration-300",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4 p-6 transition-opacity duration-300",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"エクスポート"}),(0,l.jsx)("button",{onClick:D,className:"text-muted-foreground hover:text-foreground text-2xl",title:"閉じる",children:"\xd7"})]}),(0,l.jsxs)("div",{className:"flex border-b mb-4",children:[(0,l.jsx)("button",{onClick:()=>C("script"),className:"flex-1 px-4 py-2 font-medium transition-colors ".concat("script"===S?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:"台本"}),(0,l.jsx)("button",{onClick:()=>C("character"),className:"flex-1 px-4 py-2 font-medium transition-colors ".concat("character"===S?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"),children:"キャラクター設定"})]}),"script"===S&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("span",{className:"text-foreground mb-2 font-semibold",children:"CSVのエクスポート形式(UTF-8)"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,l.jsx)("input",{type:"radio",name:"exportType",value:"full",checked:"full"===x&&!N,onChange:e=>{h(e.target.value),k(!1)},className:"text-primary"}),(0,l.jsx)("span",{className:"text-foreground",children:"話者とセリフの両方をエクスポート"})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,l.jsx)("input",{type:"radio",name:"exportType",value:"serif-only",checked:"serif-only"===x&&!N,onChange:e=>{h(e.target.value),k(!1)},className:"text-primary"}),(0,l.jsx)("span",{className:"text-foreground",children:"セリフのみをエクスポート"})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,l.jsx)("input",{type:"radio",name:"exportType",value:"clipboard",checked:N,onChange:e=>{k(e.target.checked),e.target.checked&&(h("serif-only"),b(!1))},className:"text-primary"}),(0,l.jsx)("span",{className:"text-foreground",children:"クリップボードにセリフをコピーする"})]})]})]}),(0,l.jsx)("span",{className:"text-foreground mb-2 font-semibold",children:"エクスポートオプション"}),(0,l.jsxs)("div",{className:"p-2 mr-4",children:[(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer mb-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:v,onChange:e=>j(e.target.checked),className:"text-primary"}),(0,l.jsx)("span",{className:"font-medium text-foreground",children:"ト書きを含めて出力"})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer mb-2 ".concat(0===c.length?"opacity-50":""),children:[(0,l.jsx)("input",{type:"checkbox",checked:y,onChange:e=>w(e.target.checked),className:"text-primary",disabled:0===c.length}),(0,l.jsxs)("span",{className:"font-medium ".concat(0===c.length?"text-muted-foreground":"text-foreground"),children:["選択ブロックのみエクスポート ",c.length>0&&"(".concat(c.length,"個)")]})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer mb-2 ".concat(N?"opacity-50":""),children:[(0,l.jsx)("input",{type:"checkbox",checked:g,onChange:e=>b(e.target.checked),className:"text-primary",disabled:N}),(0,l.jsx)("span",{className:"font-medium ".concat(N?"text-muted-foreground":"text-foreground"),children:"グループごとにエクスポート"})]}),g&&(0,l.jsxs)("div",{className:"mb-4 border border text-foreground-muted rounded-lg p-2",children:[o.length>0&&(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer p-1 hover:bg-accent rounded pb-2",children:[(0,l.jsx)("input",{type:"checkbox",ref:e=>{e&&(e.indeterminate="indeterminate"===I())},checked:!0===I(),onChange:()=>{!0===I()?f([]):f([...o])},className:"text-primary"}),(0,l.jsx)("span",{className:"text-foreground text-sm font-medium",children:"エクスポートするグループを選択"})]}),(0,l.jsx)("div",{className:"max-h-40 overflow-y-auto text-foreground-muted rounded p-2 space-y-1",children:0===o.length?(0,l.jsx)("p",{className:"text-muted-foreground text-sm",children:"グループがありません"}):o.map(e=>(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer p-1 hover:bg-accent rounded",children:[(0,l.jsx)("input",{type:"checkbox",checked:p.includes(e),onChange:()=>_(e),className:"text-primary"}),(0,l.jsx)("span",{className:"text-foreground text-sm",children:e}),(0,l.jsxs)("span",{className:"text-muted-foreground text-xs",children:["(",n.filter(t=>t.group===e).length,"人)"]})]},e))}),0===p.length&&g&&(0,l.jsx)("p",{className:"text-destructive text-xs mt-1",children:"グループを選択してください"})]})]})]}),"character"===S&&(0,l.jsxs)("div",{className:"mb-4",children:[(0,l.jsx)("span",{className:"text-foreground mb-2 font-semibold",children:"キャラクター設定"}),(0,l.jsx)("div",{className:"space-y-2",children:(0,l.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer",children:[(0,l.jsx)("input",{type:"radio",name:"exportType",value:"character-setting",checked:"character-setting"===x,onChange:e=>h(e.target.value),className:"text-primary"}),(0,l.jsx)("span",{className:"text-foreground",children:"キャラクター設定のエクスポート"})]})})]}),(0,l.jsx)("div",{className:"flex flex-col space-y-2 mt-4",children:(0,l.jsx)("button",{onClick:()=>{"character-setting"===x?(u(),D()):("full"===x||"serif-only"===x)&&E(x,v)},className:"w-full px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 font-semibold",children:N?"クリップボードに出力":"エクスポート"})})]})}):null}let I=()=>{let[e,t]=(0,s.useState)("/rogo.png");return(0,s.useEffect)(()=>{window.getLogoPath&&t(window.getLogoPath())},[]),e};function _(e){let{isOpen:t,onClose:r,onImportToCurrent:n,onImportToNew:o}=e,[c,i]=(0,s.useState)("");return((0,s.useEffect)(()=>{t||i("")},[t]),t)?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4 p-6 relative",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"CSVインポート先の選択"}),(0,l.jsx)("button",{onClick:()=>{i(""),r()},className:"text-muted-foreground hover:text-foreground text-2xl",title:"キャンセル",children:"\xd7"})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("button",{onClick:()=>{i(""),n()},className:"w-full px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 font-semibold",children:"現在のプロジェクトに追加"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"mb-2 text-foreground",children:"新しいプロジェクトを作成してインポート"}),(0,l.jsx)("input",{type:"text",value:c,onChange:e=>i(e.target.value),placeholder:"プロジェクト名",className:"w-full p-2 border rounded mb-2"}),(0,l.jsx)("button",{onClick:()=>{o(c),i("")},disabled:!c.trim(),className:"w-full px-4 py-2 bg-secondary text-secondary-foreground rounded hover:bg-secondary/90 font-semibold disabled:opacity-50",children:"新規作成してインポート"})]})]})]})}):null}function E(e){let{isOpen:t,onClose:r,currentName:n,onRename:o}=e,[c,i]=(0,s.useState)(n),a=(0,s.useRef)(null);return((0,s.useEffect)(()=>{i(n)},[n,t]),(0,s.useEffect)(()=>{t&&a.current&&setTimeout(()=>{var e,t;null===(e=a.current)||void 0===e||e.focus(),null===(t=a.current)||void 0===t||t.select()},100)},[t]),t)?(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4 p-6",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"プロジェクト名の変更"}),(0,l.jsx)("input",{ref:a,type:"text",value:c,onChange:e=>i(e.target.value),className:"w-full p-2 border rounded mb-4"}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{onClick:r,className:"px-4 py-2 text-muted-foreground hover:bg-accent rounded",children:"キャンセル"}),(0,l.jsx)("button",{onClick:()=>{o(c),r()},disabled:!c.trim(),className:"px-4 py-2 bg-primary text-primary-foreground rounded hover:bg-primary/90 font-semibold disabled:opacity-50",children:"変更"})]})]})}):null}function D(e){let{characters:t,onAddCharacter:r,onUpdateCharacter:m,onDeleteCharacter:x,onThemeChange:h,onExportCSV:p,onExportSerifOnly:f,onExportCharacterCSV:g,onExportByGroups:b,onExportToClipboard:v,onImportCSV:y,onImportCharacterCSV:w,isDarkMode:N,saveDirectory:k,onSaveDirectoryChange:D,groups:A,onAddGroup:T,onDeleteGroup:P,onReorderCharacters:L,onReorderGroups:U,projectName:R,onRenameProject:O,selectedBlockIds:B}=e,V=I(),[Z,M]=(0,s.useState)(!1),[K,J]=(0,s.useState)(!1),[F,z]=(0,s.useState)(!1),[H,W]=(0,s.useState)(!1),[G,Y]=(0,s.useState)(!1),[q,Q]=(0,s.useState)(null),[X,$]=(0,s.useState)(null),[ee,et]=(0,s.useState)(!1),er=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{er.current&&!er.current.contains(e.target)&&z(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let el=async(e,t)=>{var r,l;let s=null===(r=e.target.files)||void 0===r?void 0:r[0];if(s)try{let e=(await s.text()).split(/\r?\n/).filter(e=>""!==e.trim())[0]||"",t=(null===(l=e.split(",")[0])||void 0===l?void 0:l.trim())||"";"名前"===t?w(s):(Q(s),$("script"),Y(!0),z(!1))}catch(e){console.error("ファイル読み込みエラー:",e),alert("ファイルの読み込みに失敗しました。")}e.target.value=""};return(0,l.jsxs)("header",{className:"bg-background shadow-sm sticky top-0 z-50 border-b",children:[(0,l.jsxs)("div",{className:"max-w-6xl mx-auto px-4 flex items-center justify-between h-16",children:[(0,l.jsxs)("h1",{className:"text-2xl font-bold text-primary tracking-tight flex items-center",children:[(0,l.jsx)("img",{src:V,alt:"VoiScripter",className:"h-8 mr-2"}),(0,l.jsxs)("span",{className:"ml-4 pr-6 text-lg font-normal text-foreground align-middle group relative",children:[R,(0,l.jsx)("button",{onClick:()=>et(!0),className:"ml-2 p-1 rounded hover:bg-accent align-middle hidden group-hover:inline-block absolute top-1/2 -translate-y-1/2",title:"プロジェクト名を変更",children:(0,l.jsx)(n.Z,{className:"w-5 h-5 inline-block"})})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("button",{onClick:()=>J(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"CSVエクスポート",children:(0,l.jsx)(o.Z,{className:"w-7 h-7"})}),(0,l.jsxs)("div",{className:"relative",ref:er,children:[(0,l.jsx)("button",{onClick:()=>z(e=>!e),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"インポート",children:(0,l.jsx)(c.Z,{className:"w-7 h-7"})}),F&&(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-popover border rounded-lg shadow-lg z-10",children:[(0,l.jsxs)("label",{className:"block w-full text-left px-4 py-2 hover:bg-accent text-foreground cursor-pointer",children:["CSVインポート（話者,セリフ）",(0,l.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>el(e,"script")})]}),(0,l.jsxs)("label",{className:"block w-full text-left px-4 py-2 hover:bg-accent text-foreground cursor-pointer",children:["キャラクター設定のインポート",(0,l.jsx)("input",{type:"file",accept:".csv",className:"hidden",onChange:e=>el(e,"character")})]})]})]}),(0,l.jsx)("button",{onClick:()=>M(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"キャラクター設定",children:(0,l.jsx)(i.Z,{className:"w-7 h-7"})}),(0,l.jsx)("button",{onClick:()=>{h(!N)},className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"ダークモード切替",children:N?(0,l.jsx)(a.Z,{className:"w-7 h-7"}):(0,l.jsx)(d.Z,{className:"w-7 h-7"})}),(0,l.jsx)("button",{onClick:()=>W(!0),className:"p-2 text-primary hover:bg-accent rounded-lg transition",title:"設定",children:(0,l.jsx)(u.Z,{className:"w-7 h-7"})})]})]}),Z&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 transition-opacity duration-300",children:(0,l.jsxs)("div",{className:"bg-card border rounded-lg p-6 w-full max-w-3xl mx-4 shadow-xl transition-opacity duration-300",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,l.jsx)("h2",{className:"text-xl font-bold text-card-foreground",children:"キャラクター管理"}),(0,l.jsx)("button",{onClick:()=>M(!1),className:"text-muted-foreground hover:text-foreground text-2xl",title:"閉じる",children:"\xd7"})]}),(0,l.jsx)(j,{characters:t,onAddCharacter:r,onUpdateCharacter:m,onDeleteCharacter:x,groups:A,onAddGroup:T,onDeleteGroup:P,onReorderCharacters:L,onReorderGroups:U})]})}),H&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 transition-opacity duration-300",children:(0,l.jsx)(S,{isOpen:H,onClose:()=>W(!1),saveDirectory:k,onSaveDirectoryChange:D})}),(0,l.jsx)(C,{isOpen:K,onClose:()=>J(!1),characters:t,groups:A,selectedBlockIds:B,onExportCSV:p,onExportSerifOnly:f,onExportByGroups:b,onExportCharacterCSV:g,onExportToClipboard:v}),(0,l.jsx)(_,{isOpen:G&&!!q&&!!X,onClose:()=>{Y(!1),Q(null),$(null)},onImportToCurrent:()=>{q&&"script"===X?y(q,{mode:"append"}):q&&"character"===X&&w(q),Y(!1),Q(null),$(null)},onImportToNew:e=>{q&&"script"===X?y(q,{mode:"new",projectName:e}):q&&"character"===X&&w(q),Y(!1),Q(null),$(null)}}),(0,l.jsx)(E,{isOpen:ee,onClose:()=>et(!1),currentName:R,onRename:O})]})}var A=r(2360),T=r(1932),P=r(6254),L=r(7266);function U(e){var t,r;let{block:n,characters:o,character:c,onUpdate:i,onDelete:a,onDuplicate:d,onMoveUp:u,onMoveDown:x,onClick:h,textareaRef:g,isSelected:b}=e,{attributes:v,listeners:j,setNodeRef:y,transform:w,transition:N,isDragging:k}=(0,p.nB)({id:n.id}),S={transform:f.ux.Transform.toString(w),transition:N,opacity:k?.5:1},C=!n.characterId,[I,_]=(0,s.useState)(!1),E=(0,s.useRef)(n.characterId);(0,s.useEffect)(()=>{if(n.characterId&&n.characterId!==E.current){_(!0);let e=setTimeout(()=>_(!1),300);return E.current=n.characterId,()=>clearTimeout(e)}E.current=n.characterId},[n.characterId]);let[D,U]=(0,s.useState)(!1);return(0,l.jsxs)("div",{ref:y,style:S,className:"flex items-start space-x-2 p-2 border rounded-lg shadow mb-2 transition-colors ".concat(b&&!D?"ring-2 ring-primary ring-opacity-50":""),onClick:h,children:[(0,l.jsx)("div",{...v,...j,className:"cursor-grab flex items-center justify-center w-8 h-6 rounded hover:bg-accent transition",children:(0,l.jsx)(A.Z,{className:"w-8 h-8 text-primary"})}),(0,l.jsx)("div",{className:"flex-1",children:C?(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("textarea",{ref:g,value:n.text,onChange:e=>i({text:e.target.value}),placeholder:"ト書きを入力",className:"w-full p-2 pt-2 border rounded min-h-[40px] bg-muted text-foreground focus:ring-1 focus:ring-ring text-sm italic focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400 resize-none overflow-hidden",rows:1,style:{height:"auto",borderRadius:"20px 20px 20px 0"},onFocus:()=>U(!0),onBlur:()=>U(!1),onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"}}),(0,l.jsxs)("div",{className:"flex flex-col justify-between items-center h-16 mr-2 mt-0",children:[(0,l.jsxs)("select",{value:n.characterId,onChange:e=>i({characterId:e.target.value}),className:"ml-1 p-2 pl-3 border rounded bg-background text-foreground focus:ring-1 focus:ring-ring text-xs w-36 mb-1",style:{height:"2.5rem"},children:[(0,l.jsx)("option",{value:"",children:"ト書きを入力"}),o.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsxs)("div",{className:"flex flex-row space-x-1.5 mt-0",children:[(0,l.jsx)("button",{onClick:u,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↑:ブロックを上に移動",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(T.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:x,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↓:ブロックを下に移動",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(P.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:d,className:"p-1 rounded hover:bg-accent",title:"Ctrl+B:ブロックを複製",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(L.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:a,className:"p-1 text-destructive hover:bg-destructive/10 rounded",title:"Alt+B:ブロックを削除",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(m.Z,{className:"w-6 h-6"})})]})]})]}):(0,l.jsxs)("div",{className:"flex items-start space-x-2",children:[c&&((null===(t=c.emotions[n.emotion])||void 0===t?void 0:t.iconUrl)?(0,l.jsx)("img",{src:null===(r=c.emotions[n.emotion])||void 0===r?void 0:r.iconUrl,alt:c.name,className:"w-16 h-16 rounded-full object-cover mt-0 mr-2 transition-all duration-300 ".concat(I?"outline-4 outline-primary outline-offset-2":"")}):(0,l.jsx)("div",{className:"w-16 h-16 rounded-full flex items-center justify-center text-center mt-0 mr-2 overflow-hidden transition-all duration-300 ".concat(I?"outline-4 outline-primary outline-offset-2":""),style:{backgroundColor:c.backgroundColor||"#e5e7eb"},children:(0,l.jsx)("span",{className:"text-xs font-bold text-foreground px-1 max-w-[80px] whitespace-no-wrap overflow-hidden".concat(c.name.length>8?" text-ellipsis":""),style:{textShadow:"\n                        -1px -1px 0 var(--color-background),  \n                         1px -1px 0 var(--color-background),\n                        -1px  1px 0 var(--color-background),\n                         1px  1px 0 var(--color-background)\n                      "},children:c.name.length>8?c.name.slice(0,8)+"…":c.name})})),(0,l.jsxs)("div",{className:"relative flex-1 pl-2",children:[(0,l.jsx)("textarea",{ref:g,value:n.text,onChange:e=>i({text:e.target.value}),placeholder:"セリフを入力",className:"rounded-2xl border p-2 bg-card shadow-md min-h-[60px] text-sm w-full text-foreground focus:ring-1 focus:ring-ring focus:outline-none focus:ring-ring-gray-400 focus:border-gray-400 resize-none overflow-hidden",rows:1,style:{height:"auto",borderRadius:"20px 20px 20px 0"},onFocus:()=>U(!0),onBlur:()=>U(!1),onInput:e=>{let t=e.target;t.style.height="auto",t.style.height=t.scrollHeight+"px"}}),(0,l.jsx)("div",{className:"absolute left-[-4px] top-6 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-8 border-r-gray-400"})]}),(0,l.jsxs)("div",{className:"flex flex-col justify-between items-center h-16 mr-2 mt-0",children:[(0,l.jsxs)("select",{value:n.characterId,onChange:e=>i({characterId:e.target.value}),className:"ml-1 p-2 pl-3 border rounded bg-background text-foreground focus:ring-1 focus:ring-ring text-xs w-36 mb-1",style:{height:"2.5rem"},children:[(0,l.jsx)("option",{value:"",children:"ト書きを入力"}),o.map(e=>(0,l.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,l.jsxs)("div",{className:"flex flex-row space-x-1.5 mt-0",children:[(0,l.jsx)("button",{onClick:u,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↑:ブロックを上に移動",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(T.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:x,className:"p-1 rounded hover:bg-accent",title:"Ctrl+↓:ブロックを下に移動",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(P.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:d,className:"p-1 rounded hover:bg-accent",title:"Ctrl+B:ブロックを複製",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(L.Z,{className:"w-6 h-6 text-foreground"})}),(0,l.jsx)("button",{onClick:a,className:"p-1 text-destructive hover:bg-destructive/10 rounded",title:"Alt+B:ブロックを削除",style:{height:"2rem",width:"2rem"},children:(0,l.jsx)(m.Z,{className:"w-6 h-6"})})]})]})]})})]})}function R(e){let{script:t,onUpdateBlock:r,onAddBlock:n,onDeleteBlock:o,onInsertBlock:c,onMoveBlock:i,selectedBlockIds:a,onSelectedBlockIdsChange:d,onOpenCSVExport:u}=e,m=(0,h.Dy)((0,h.VT)(h.we),(0,h.VT)(h.Lg,{coordinateGetter:p.is})),f=(0,s.useRef)([]),[g,b]=(0,s.useState)(!1),[v,j]=(0,s.useState)(null),[y,w]=(0,s.useState)(-1),N=(e,r,l)=>{if("TEXTAREA"!==l.target.tagName){if(l.preventDefault(),l.shiftKey&&(l.preventDefault(),window.getSelection)){var s;null===(s=window.getSelection())||void 0===s||s.removeAllRanges()}if(l.ctrlKey||l.metaKey)d(a.includes(e)?a.filter(t=>t!==e):[...a,e]),w(r);else if(l.shiftKey&&y>=0){let e=Math.max(y,r);d(t.blocks.slice(Math.min(y,r),e+1).map(e=>e.id))}else d([e]),w(r)}};(0,s.useEffect)(()=>{f.current=f.current.slice(0,t.blocks.length),setTimeout(()=>{f.current.forEach(e=>{e&&(e.style.height="auto",e.style.height=e.scrollHeight+"px")})},0);let e=t.blocks.findIndex(e=>e.id===a[0]),r=Math.max(t.blocks.length,k.current);if(t.blocks.length>0&&r<=t.blocks.length&&k.current<=e+1){let e=t.blocks.length-1,r=f.current[e];if(r){let e=window.scrollY,t=window.innerHeight,l=document.documentElement.scrollHeight,s=r.getBoundingClientRect(),n=s.bottom>t&&s.bottom>0;e+t<l&&n&&setTimeout(()=>{window.scrollTo({top:l-t,behavior:"smooth"})},50)}}},[t.blocks.length,a]),(0,s.useEffect)(()=>{let e=()=>{let e=document.querySelector(".script-editor-container");e&&b(e.scrollHeight>window.innerHeight-200)};e(),window.addEventListener("resize",e);let t=setTimeout(e,1);return()=>{window.removeEventListener("resize",e),clearTimeout(t)}},[t.blocks]),(0,s.useEffect)(()=>{let e=e=>{let r=e.target,l=f.current.findIndex(e=>e===r);if(l>=0){var s;d([(null===(s=t.blocks[l])||void 0===s?void 0:s.id)||""]),w(l)}},r=()=>{};return f.current.forEach(t=>{t&&(t.addEventListener("focus",e),t.addEventListener("blur",r))}),()=>{f.current.forEach(t=>{t&&(t.removeEventListener("focus",e),t.removeEventListener("blur",r))})}},[t.blocks]);let k=(0,s.useRef)(t.blocks.length),S=(0,s.useRef)(-1);(0,s.useEffect)(()=>{if(t.blocks.length>k.current){if(v){console.log("Skipping auto focus due to manual focus target"),j(null),k.current=t.blocks.length;return}if(S.current>=0){console.log("Auto focusing inserted block at index: ".concat(S.current)),setTimeout(()=>{var e,r;null===(e=f.current[S.current])||void 0===e||e.focus(),d([(null===(r=t.blocks[S.current])||void 0===r?void 0:r.id)||""]),S.current=-1},10),k.current=t.blocks.length;return}console.log("Auto focusing last block"),setTimeout(()=>{var e,r;let l=t.blocks.length-1;null===(e=f.current[l])||void 0===e||e.focus(),d([(null===(r=t.blocks[l])||void 0===r?void 0:r.id)||""])},10)}k.current=t.blocks.length},[t.blocks.length,v]),(0,s.useEffect)(()=>{let e=e=>{let r=e.target,l=f.current.findIndex(e=>e===r);if(l>=0){var s;d([(null===(s=t.blocks[l])||void 0===s?void 0:s.id)||""]),w(l)}},r=()=>{};return f.current.forEach(t=>{t&&(t.addEventListener("focus",e),t.addEventListener("blur",r))}),()=>{f.current.forEach(t=>{t&&(t.removeEventListener("focus",e),t.removeEventListener("blur",r))})}},[t.blocks]),(0,s.useEffect)(()=>{v&&setTimeout(()=>{let e=f.current[v.index];if(e){let t=e.getBoundingClientRect(),r=window.innerHeight,l=t.bottom>r||t.top<64,s=l?window.scrollY:null;e.focus(),d([v.id]),l&&null!==s?setTimeout(()=>{window.scrollY!==s&&window.scrollTo(0,s),A(v.index,20)},5):A(v.index,5)}j(null)},5)},[v]);let C=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,r=window.scrollY,l=e-r,s=performance.now();requestAnimationFrame(function e(n){let o=Math.min((n-s)/t,1);window.scrollTo(0,r+l*(o<.5?2*o*o:-1+(4-2*o)*o)),o<1&&requestAnimationFrame(e)})},[I,_]=(0,s.useState)(!1),[E,D]=(0,s.useState)(!1),A=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;setTimeout(()=>{let t=f.current[e];if(t){let e=t.getBoundingClientRect(),r=window.innerHeight;if(e.bottom>r){let t=e.bottom-r+20;window.scrollBy({top:t,behavior:"smooth"})}else if(e.top<64){let t=e.top-64-20;window.scrollBy({top:t,behavior:"smooth"})}}},t)},L=()=>{_(!0),setTimeout(()=>_(!1),300),C(0,500),setTimeout(()=>{if(f.current[0]){var e,r;null===(e=f.current[0])||void 0===e||e.focus(),d([(null===(r=t.blocks[0])||void 0===r?void 0:r.id)||""])}},500)},R=()=>{D(!0),setTimeout(()=>D(!1),300),C(document.body.scrollHeight,500),setTimeout(()=>{let e=t.blocks.length-1;if(f.current[e]){var r,l;null===(r=f.current[e])||void 0===r||r.focus(),d([(null===(l=t.blocks[e])||void 0===l?void 0:l.id)||""])}},500)};(0,s.useEffect)(()=>{let e=e=>{let l=f.current.findIndex(e=>e===document.activeElement);if(e.ctrlKey&&!e.altKey&&"b"===e.key)e.preventDefault(),n(),setTimeout(()=>{var e;let r=t.blocks.length;j({index:r,id:(null===(e=t.blocks[r])||void 0===e?void 0:e.id)||""})},10);else if(e.ctrlKey&&e.altKey&&"b"===e.key){e.preventDefault();let r=l>=0?l+1:t.blocks.length,s={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:""};S.current=r,c(s,r),setTimeout(()=>{j({index:r,id:s.id})},10)}else if(!e.ctrlKey&&e.altKey&&"b"===e.key)l>=0&&(e.preventDefault(),o(t.blocks[l].id),setTimeout(()=>{var e,t;f.current[l]?null===(e=f.current[l])||void 0===e||e.focus():f.current[l-1]&&(null===(t=f.current[l-1])||void 0===t||t.focus())},0));else if(!e.ctrlKey&&e.altKey&&"ArrowUp"===e.key){if(l>=0){let s=t.blocks[l];if(s.characterId){let l=t.characters.findIndex(e=>e.id===s.characterId);l>0&&(e.preventDefault(),r(s.id,{characterId:t.characters[l-1].id}))}}}else if(!e.ctrlKey&&e.altKey&&"ArrowDown"===e.key){if(l>=0){let s=t.blocks[l];if(s.characterId){let l=t.characters.findIndex(e=>e.id===s.characterId);l>=0&&l<t.characters.length-1&&(e.preventDefault(),r(s.id,{characterId:t.characters[l+1].id}))}}}else if(e.ctrlKey||"ArrowUp"!==e.key){if(e.ctrlKey||"ArrowDown"!==e.key){if(e.ctrlKey&&"Enter"===e.key){if(l>=0){e.preventDefault();let r=t.blocks[l],s={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:r.characterId,emotion:r.emotion,text:""};S.current=l+1,c(s,l+1),setTimeout(()=>{j({index:l+1,id:s.id})},50)}}else if(e.ctrlKey&&"ArrowUp"===e.key){if(l>0){e.preventDefault();let r=t.blocks[l].id;i(l,l-1),d([r]),setTimeout(()=>{j({index:l-1,id:r}),A(l-1,50)},10)}}else if(e.ctrlKey&&"ArrowDown"===e.key&&l>=0&&l<t.blocks.length-1){e.preventDefault();let r=t.blocks[l].id;i(l,l+1),d([r]),setTimeout(()=>{j({index:l+1,id:r}),A(l+1,50)},10)}}else if(l>=0&&l<t.blocks.length-1){let t=f.current[l];if(t){let{selectionStart:r}=t,s=t.value;if(s.slice(0,r).split("\n").length===s.split("\n").length){e.preventDefault();let t=l+1,r=f.current[t];if(r){let e=r.getBoundingClientRect(),l=window.innerHeight,s=e.bottom>l||e.top<64,n=s?window.scrollY:null;r.focus(),s&&null!==n?setTimeout(()=>{window.scrollY!==n&&window.scrollTo(0,n),A(t,20)},5):A(t,5)}}}}}else if(l>0){let t=f.current[l];if(t){let{selectionStart:r}=t;if(1===t.value.slice(0,r).split("\n").length){e.preventDefault();let t=l-1,r=f.current[t];if(r){let e=r.getBoundingClientRect(),l=window.innerHeight,s=e.bottom>l||e.top<64,n=s?window.scrollY:null;r.focus(),s&&null!==n?setTimeout(()=>{window.scrollY!==n&&window.scrollTo(0,n),A(t,20)},5):A(t,5)}}}}e.ctrlKey&&","===e.key?(e.preventDefault(),R()):e.ctrlKey&&"m"===e.key?(e.preventDefault(),u()):e.ctrlKey&&e.altKey&&","===e.key&&(e.preventDefault(),L())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t.blocks,n,c,i,o]);let O=e=>{let t={id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:""};S.current=e,c(t,e),setTimeout(()=>{j({index:e,id:t.id})},10)};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"script-editor-container min-h-auto",children:0===t.blocks.length?(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center p-8 text-center text-muted-foreground",children:[(0,l.jsx)("p",{className:"text-lg mb-4",children:"1.左上の新規作成から新しいプロジェクトを作成してください。"}),(0,l.jsx)("p",{className:"text-lg mb-4",children:"2.キャラクターのアイコンからキャラクターを追加し、下のボタンからブロックを追加します。"})]}):(0,l.jsx)("div",{className:"bg-card rounded-lg shadow p-4 relative h-full flex flex-col justify-between",children:(0,l.jsx)(h.LB,{sensors:m,collisionDetection:h.pE,onDragEnd:e=>{let{active:r,over:l}=e;l&&r.id!==l.id&&i(t.blocks.findIndex(e=>e.id===r.id),t.blocks.findIndex(e=>e.id===l.id))},children:(0,l.jsx)(p.Fo,{items:t.blocks.map(e=>e.id),strategy:p.qw,children:t.blocks.map((e,s)=>(0,l.jsxs)("div",{className:"mb-1 last:mb-0",children:[(0,l.jsx)(U,{block:e,characters:t.characters,character:t.characters.find(t=>t.id===e.characterId),onUpdate:t=>r(e.id,t),onDelete:()=>o(e.id),onDuplicate:()=>{let t={...e,id:Date.now().toString()+Math.random().toString(36).substr(2,9),text:e.text};S.current=s+1,c(t,s+1),setTimeout(()=>{j({index:s+1,id:t.id})},10)},onMoveUp:()=>{s>0&&i(s,s-1)},onMoveDown:()=>{s<t.blocks.length-1&&i(s,s+1)},textareaRef:e=>f.current[s]=e,isSelected:a.includes(e.id),onClick:t=>N(e.id,s,t)}),(0,l.jsx)("div",{className:"flex justify-center my-1 group",children:(0,l.jsx)("button",{className:"hidden group-hover:inline-block px-2 py-1 bg-primary text-primary-foreground rounded text-xs",onClick:()=>O(s+1),children:"＋ト書きを追加"})})]},e.id))})})})}),(0,l.jsxs)("div",{className:"fixed right-6 z-40 flex flex-row items-end space-x-2 bottom-6",children:[(0,l.jsx)("button",{onClick:L,className:"px-3 py-2 bg-secondary hover:bg-secondary/90 text-secondary-foreground rounded-full shadow-lg text-lg transition-transform duration-600 ".concat(I?"-translate-y-2":""),title:"Ctrl+Alt+↑: 最上段へ",children:(0,l.jsx)(T.Z,{className:"w-6 h-6"})}),(0,l.jsx)("button",{onClick:R,className:"px-3 py-2 bg-secondary hover:bg-secondary/90 text-secondary-foreground rounded-full shadow-lg text-lg transition-transform duration-600 ".concat(E?"translate-y-2":""),title:"Ctrl+,: 最下段へ",children:(0,l.jsx)(P.Z,{className:"w-6 h-6"})}),(0,l.jsxs)("button",{onClick:n,className:"px-4 py-2 bg-primary hover:bg-primary/90 text-primary-foreground rounded-full shadow-lg transition-all text-lg",title:"Ctrl+B:新規ブロックを追加",children:[(0,l.jsx)(x.Z,{className:"w-6 h-6 inline-block mr-0.5 mb-0.5"}),"ブロックを追加"]})]})]})}function O(e){let{isOpen:t,onClose:r,onConfirm:n,existingProjects:o}=e,[c,i]=(0,s.useState)(""),[a,d]=(0,s.useState)(""),u=()=>{i(""),d(""),r()};return t?(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,l.jsxs)("div",{className:"bg-background border rounded-lg shadow-lg w-full max-w-md mx-4",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center p-4 border-b",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"新しいプロジェクト"}),(0,l.jsx)("button",{onClick:u,className:"p-1 hover:bg-accent rounded transition-colors",children:(0,l.jsx)(y.Z,{className:"w-5 h-5 text-foreground"})})]}),(0,l.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),!c.trim()){d("プロジェクト名を入力してください");return}if(o.includes(c.trim())){d("同名のプロジェクトが既に存在します");return}n(c.trim()),i(""),d(""),r()},className:"p-4 space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"projectName",className:"block text-sm font-medium text-foreground mb-2",children:"プロジェクト名"}),(0,l.jsx)("input",{type:"text",id:"projectName",value:c,onChange:e=>{i(e.target.value),d("")},className:"w-full p-2 border rounded bg-background text-foreground focus:ring-2 focus:ring-ring focus:outline-none",placeholder:"プロジェクト名を入力",autoFocus:!0}),a&&(0,l.jsx)("p",{className:"text-sm text-destructive mt-1",children:a})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,l.jsx)("button",{type:"button",onClick:u,className:"px-4 py-2 text-sm text-muted-foreground hover:bg-accent rounded transition-colors",children:"キャンセル"}),(0,l.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm bg-primary text-primary-foreground rounded hover:bg-primary/90 transition-colors",children:"作成"})]})]})]})}):null}function B(){let[e,t]=(0,s.useState)([]),[r,n]=(0,s.useState)([]),[o,c]=(0,s.useState)("default");(0,s.useEffect)(()=>{{let e=localStorage.getItem("voiscripter_lastProject");e&&"lastProject"!==e&&c(e)}},[]);let[i,a]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[m,x]=(0,s.useState)([]),[h,p]=(0,s.useState)({id:"1",title:"新しい台本",blocks:[]}),[f,g]=(0,s.useState)([]),[b,v]=(0,s.useState)(""),[j,y]=(0,s.useState)(!1),w=(e,t)=>{if(""===b)try{localStorage.setItem(e,t)}catch(r){if(console.error("localStorage save error:",r),r instanceof Error&&"QuotaExceededError"===r.name)try{Object.keys(localStorage).filter(e=>e.includes("_undo")||e.includes("_redo")).forEach(e=>localStorage.removeItem(e)),localStorage.setItem(e,t)}catch(e){console.error("Retry save failed:",e)}}else if(window.electronAPI){var r;null===(r=window.electronAPI)||void 0===r||r.saveData(e,t)}},N=async e=>{if(""===b)return localStorage.getItem(e);if(window.electronAPI){var t;return await (null===(t=window.electronAPI)||void 0===t?void 0:t.loadData(e))||null}return null},k=(0,s.useRef)(!0);(0,s.useEffect)(()=>{(async()=>{let e="";if(window.electronAPI)try{e=(await window.electronAPI.loadSettings()).saveDirectory||"",v(e)}catch(e){console.error("設定読み込みエラー:",e)}else v(e=localStorage.getItem("voiscripter_saveDirectory")||"");let r=await N("voiscripter_characters");r&&t(JSON.parse(r).map(e=>({...e,group:e.group||"なし"})));let l=await N("voiscripter_groups");if(null!=l)try{let e=JSON.parse(l);if(Array.isArray(e)){n(e),k.current=!1;return}console.warn("Invalid groups data format:",e),n([]),k.current=!1;return}catch(e){console.error("Groups parse error:",e),n([]),k.current=!1;return}let s=await N("voiscripter_characters");if(s)try{let e=JSON.parse(s).map(e=>e.group||"なし").filter(e=>"なし"!==e).filter((e,t,r)=>r.indexOf(e)===t);n(e),k.current=!1}catch(e){console.error("Failed to extract groups from characters:",e),n([]),k.current=!1}else n([]),k.current=!1;let o=await N("voiscripter_lastProject"),i="default";if(o&&"lastProject"!==o&&""!==o.trim()&&(i=o),c(i),""===b)a(Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_","")));else if(window.electronAPI)try{let e=(await window.electronAPI.listDataKeys()||[]).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_",""));a(e)}catch(e){console.error("プロジェクトリスト取得エラー:",e),a([])}let d=await N("voiscripter_".concat(i));if(d)try{let e=JSON.parse(d);if(e&&"object"==typeof e&&Array.isArray(e.blocks))p(e);else throw Error("Invalid script structure")}catch(e){console.error("Script parse error:",e),alert("無効な台本形式です。または台本が壊れています。");try{""===b&&(localStorage.removeItem("voiscripter_".concat(i)),localStorage.removeItem("voiscripter_".concat(i,"_undo")),localStorage.removeItem("voiscripter_".concat(i,"_redo")))}catch(e){console.error("Cleanup error:",e)}p({id:"1",title:"新しい台本",blocks:[]})}else{if("default"===i&&window.electronAPI){var m;await (null===(m=window.electronAPI)||void 0===m?void 0:m.initializeDefaultProject())}p({id:"1",title:"新しい台本",blocks:[]})}let h=await N("voiscripter_".concat(i,"_undo"));if(h)try{let e=JSON.parse(h);Array.isArray(e)?u(e):(console.error("Invalid undo stack format"),u([]))}catch(e){console.error("Undo stack parse error:",e),u([])}let f=await N("voiscripter_".concat(i,"_redo"));if(f)try{let e=JSON.parse(f);Array.isArray(e)?x(e):(console.error("Invalid redo stack format"),x([]))}catch(e){console.error("Redo stack parse error:",e),x([])}})()},[]);let S=(0,s.useRef)(!0);(0,s.useEffect)(()=>{if(S.current){S.current=!1;return}w("voiscripter_characters",JSON.stringify(e))},[e,b]),(0,s.useEffect)(()=>{k.current||w("voiscripter_groups",JSON.stringify(r))},[r,b]),(0,s.useEffect)(()=>{w("voiscripter_lastProject",o),(async()=>{let e=await N("voiscripter_".concat(o));p(e?JSON.parse(e):{id:"1",title:"新しい台本",blocks:[]});let t=await N("voiscripter_".concat(o,"_undo"));u(t?JSON.parse(t):[]);let r=await N("voiscripter_".concat(o,"_redo"));if(x(r?JSON.parse(r):[]),""===b)a(Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_","")));else if(window.electronAPI)try{let e=(await window.electronAPI.listDataKeys()||[]).filter(e=>e.startsWith("voiscripter_")&&!e.endsWith("_undo")&&!e.endsWith("_redo")&&"voiscripter_characters"!==e&&"voiscripter_lastProject"!==e&&"voiscripter_saveDirectory"!==e&&"voiscripter_groups"!==e).map(e=>e.replace("voiscripter_",""));a(e)}catch(e){console.error("プロジェクトリスト取得エラー:",e),a([])}k.current=!0;let l=await N("voiscripter_groups");if(null!=l)try{let e=JSON.parse(l);if(Array.isArray(e)){n(e),k.current=!1;return}n([]),k.current=!1;return}catch(e){n([]),k.current=!1;return}n([]),k.current=!1})()},[o,b]);let C=(0,s.useRef)(!0),I=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if(C.current){C.current=!1;return}if(I.current){I.current=!1,w("voiscripter_".concat(o),JSON.stringify(h));return}if(u(e=>{let t=[...e,h];return t.length>50&&(t=t.slice(t.length-50)),w("voiscripter_".concat(o,"_undo"),JSON.stringify(t)),t}),x([]),""===b)localStorage.removeItem("voiscripter_".concat(o,"_redo"));else if(window.electronAPI){var e;null===(e=window.electronAPI)||void 0===e||e.saveData("voiscripter_".concat(o,"_redo"),"")}w("voiscripter_".concat(o),JSON.stringify(h))},[h,o,b]),(0,s.useEffect)(()=>{let e=e=>{if(e.ctrlKey&&"z"===e.key.toLowerCase()){if(e.preventDefault(),d.length>0){I.current=!0,x(e=>{let t=[h,...e];return w("voiscripter_".concat(o,"_redo"),JSON.stringify(t)),t});let e=d[d.length-1];u(e=>{let t=e.slice(0,-1);return w("voiscripter_".concat(o,"_undo"),JSON.stringify(t)),t}),p(e)}}else if(e.ctrlKey&&"y"===e.key.toLowerCase()&&(e.preventDefault(),m.length>0)){I.current=!0;let e=m[0];u(e=>{let t=[...e,h];return w("voiscripter_".concat(o,"_undo"),JSON.stringify(t)),t}),x(e=>{let t=e.slice(1);return w("voiscripter_".concat(o,"_redo"),JSON.stringify(t)),t}),p(e)}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[d,m,h,o,b]);let[_,E]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=()=>{let e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,r="dark"===e||!e&&t;E(r),document.documentElement.classList.toggle("dark",r)};e();let t=window.matchMedia("(prefers-color-scheme: dark)"),r=()=>{localStorage.getItem("theme")||e()};return t.addEventListener("change",r),()=>{t.removeEventListener("change",r)}},[]);let A=async e=>{if(v(e),window.electronAPI)try{await window.electronAPI.saveSettings({saveDirectory:e})}catch(e){console.error("設定保存エラー:",e)}else localStorage.setItem("voiscripter_saveDirectory",e);if(""!==e&&""===b){if(window.electronAPI)for(let e of Object.keys(localStorage).filter(e=>e.startsWith("voiscripter_"))){let t=localStorage.getItem(e);if(t)try{await window.electronAPI.saveData(e,t)}catch(t){console.error("データ移動エラー (".concat(e,"):"),t)}}}else if(""===e&&""!==b&&window.electronAPI)try{for(let e of await window.electronAPI.listDataKeys()||[]){let t=await window.electronAPI.loadData(e);t&&localStorage.setItem(e,t)}}catch(e){console.error("データ移動エラー:",e)}},T=async(t,r)=>{let l=h.blocks;r&&f.length>0&&(l=h.blocks.filter(e=>f.includes(e.id)));let s=l.filter(e=>!!t||e.characterId).map(t=>{if(!t.characterId)return["ト書き",t.text.replace(/\n/g,"\\n")];let r=e.find(e=>e.id===t.characterId);return[r?r.name:"",t.text.replace(/\n/g,"\\n")]}).map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),n="".concat(h.title||"script",".csv");if(window.electronAPI)try{await window.electronAPI.saveCSVFile(n,s)}catch(e){console.error("CSV保存エラー:",e),alert("CSVファイルの保存に失敗しました。")}else{let e=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=n,r.click(),URL.revokeObjectURL(t)}},P=async e=>{let t=h.blocks;e&&f.length>0&&(t=h.blocks.filter(e=>f.includes(e.id)));let r=t.filter(e=>e.characterId).map(e=>[e.text]).map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),l="".concat(h.title||"serif",".csv");if(window.electronAPI)try{await window.electronAPI.saveCSVFile(l,r)}catch(e){console.error("CSV保存エラー:",e),alert("CSVファイルの保存に失敗しました。")}else{let e=new Blob([r],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download=l,s.click(),URL.revokeObjectURL(t)}},L=async(t,r,l,s)=>{for(let n of t){let t,o;let c=e.filter(e=>e.group===n).map(e=>e.id),i=h.blocks.filter(e=>e.characterId&&c.includes(e.characterId));if(l&&(i=[...i,...h.blocks.filter(e=>!e.characterId)]),s&&f.length>0&&(i=i.filter(e=>f.includes(e.id))),0===i.length){console.log("グループ「".concat(n,"」にはセリフがありません"));continue}"full"===r?(t=i.map(t=>{if(!t.characterId)return["ト書き",t.text.replace(/\n/g,"\\n")];let r=e.find(e=>e.id===t.characterId);return[r?r.name:"",t.text.replace(/\n/g,"\\n")]}),o="".concat(h.title||"script","_").concat(n,".csv")):(t=i.map(e=>[e.text.replace(/\n/g,"\\n")]),o="".concat(h.title||"serif","_").concat(n,".csv"));let a=t.map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n");if(window.electronAPI)try{await window.electronAPI.saveCSVFile(o,a)}catch(e){console.error("CSV保存エラー (".concat(n,"):"),e),alert("グループ「".concat(n,"」のCSVファイルの保存に失敗しました。"))}else{let e=new Blob([a],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=o,r.click(),URL.revokeObjectURL(t)}}},U=async(t,r,l)=>{let s,n=h.blocks;r&&f.length>0&&(n=h.blocks.filter(e=>f.includes(e.id))),s=t?n.filter(e=>!!l||e.characterId).map(e=>e.text).join("\n"):n.filter(e=>!!l||e.characterId).map(t=>{if(!t.characterId)return t.text;{let r=e.find(e=>e.id===t.characterId);return"".concat(r?r.name:"",": ").concat(t.text)}}).join("\n");try{await navigator.clipboard.writeText(s),alert("クリップボードにコピーしました。")}catch(e){console.error("クリップボード出力エラー:",e),alert("クリップボードへの出力に失敗しました。")}},B=async(t,r)=>{try{let l=(await t.text()).split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>{let t=[],r="",l=!1;for(let s=0;s<e.length;s++){let n=e[s];'"'===n?l&&'"'===e[s+1]?(r+='"',s++):l=!l:","!==n||l?r+=n:(t.push(r.trim()),r="")}return t.push(r.trim()),t}),s=l;l.length>0&&(l[0][0].includes("話者")||l[0][0].toLowerCase().includes("speaker"))&&(s=l.slice(1));let n=s.filter(e=>e.length>=2&&(e[0]||e[1])).map(t=>{let[r,l]=t,s=e.find(e=>e.name===r);return s?{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:s.id,emotion:"normal",text:(l||"").replace(/\\n/g,"\n").replace(/\n/g,"\n")}:"ト書き"===r?{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:(l||"").replace(/\\n/g,"\n").replace(/\n/g,"\n")}:{id:Date.now().toString()+Math.random().toString(36).substr(2,9),characterId:"",emotion:"normal",text:"【".concat(r,"】").concat((l||"").replace(/\\n/g,"\n").replace(/\n/g,"\n"))}});(null==r?void 0:r.mode)==="new"&&r.projectName?(w("voiscripter_".concat(r.projectName),JSON.stringify({id:"1",title:r.projectName,blocks:n})),"string"==typeof r.projectName&&a(e=>e.includes(r.projectName)?e:[...e,r.projectName]),c(r.projectName),alert("".concat(n.length,"個のブロックを新規プロジェクト「").concat(r.projectName,"」にインポートしました。"))):(p(e=>({...e,blocks:[...e.blocks,...n]})),alert("".concat(n.length,"個のブロックを現在のプロジェクトにインポートしました。")))}catch(e){console.error("CSVインポートエラー:",e),alert("無効な台本形式です。または台本が壊れています。");try{p({id:"1",title:"新しい台本",blocks:[]})}catch(e){console.error("Failed to set empty script:",e)}}},V=async l=>{try{let s=(await l.text()).split(/\r?\n/).filter(e=>""!==e.trim()).map(e=>{let t=[],r="",l=!1;for(let s=0;s<e.length;s++){let n=e[s];'"'===n?l&&'"'===e[s+1]?(r+='"',s++):l=!l:","!==n||l?r+=n:(t.push(r.trim()),r="")}return t.push(r.trim()),t}).slice(1),o=[],c=[],i=[];if(s.filter(e=>e.length>=1&&""!==e[0].trim()).forEach(t=>{let[l,s,n]=t,a=l.trim(),d=n||"なし";e.some(e=>e.name===a&&e.group===d)?c.push(a):("なし"===d||r.includes(d)||i.push(d),o.push({id:Date.now().toString()+Math.random().toString(36).substr(2,9),name:a,group:d,emotions:{normal:{iconUrl:s||""}}}))}),c.length>0){let e="以下のキャラクターは既に存在するためインポートされませんでした：\n".concat(c.join(", "));alert(e)}let a=[];if(i.length>0){let e=i.filter((e,t)=>i.indexOf(e)===t);n(t=>{let r=e.filter(e=>!t.includes(e));return a=r,[...t,...r]})}o.length>0?(t(e=>[...e,...o]),alert("".concat(o.length,"個のキャラクターをインポートしました。").concat(a.length>0?"\n新しいグループ「".concat(a.join(", "),"」が追加されました。"):""))):0===c.length&&alert("インポート可能なキャラクターが見つかりませんでした。")}catch(e){console.error("キャラクター設定のCSVインポートエラー:",e),alert("キャラクター設定のCSVファイルのインポートに失敗しました。")}};return(0,l.jsxs)("div",{id:"root",children:[(0,l.jsxs)("div",{className:"min-h-auto bg-background text-foreground transition-colors duration-300",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 p-2",children:[(0,l.jsx)("label",{children:"プロジェクト: "}),(0,l.jsx)("select",{value:o,onChange:e=>c(e.target.value),className:"border rounded p-1",children:i.map(e=>(0,l.jsx)("option",{value:e,className:"dark:text-gray-900",children:e},e))}),(0,l.jsx)("button",{onClick:()=>{y(!0)},className:"px-2 py-1 bg-primary text-primary-foreground rounded",children:"新規作成"}),"default"!==o&&(0,l.jsx)("button",{onClick:()=>{if("default"===o){alert("デフォルトプロジェクトは削除できません");return}if(confirm("プロジェクト「".concat(o,"」を削除しますか？\nこの操作は元に戻せません。"))){if(""===b)localStorage.removeItem("voiscripter_".concat(o)),localStorage.removeItem("voiscripter_".concat(o,"_undo")),localStorage.removeItem("voiscripter_".concat(o,"_redo"));else if(window.electronAPI){var e,t,r;null===(e=window.electronAPI)||void 0===e||e.saveData("voiscripter_".concat(o),""),null===(t=window.electronAPI)||void 0===t||t.saveData("voiscripter_".concat(o,"_undo"),""),null===(r=window.electronAPI)||void 0===r||r.saveData("voiscripter_".concat(o,"_redo"),"")}a(e=>e.filter(e=>e!==o)),c("default"),p({id:"1",title:"新しい台本",blocks:[]}),u([]),x([])}},className:"px-2 py-1 bg-destructive text-destructive-foreground rounded",children:"削除"})]}),(0,l.jsx)(D,{characters:e,onAddCharacter:e=>{t(t=>[...t,e])},onUpdateCharacter:e=>{t(t=>t.map(t=>t.id===e.id?e:t))},onDeleteCharacter:e=>{t(t=>t.filter(t=>t.id!==e)),p(t=>({...t,blocks:t.blocks.map(t=>t.characterId===e?{...t,characterId:""}:t)}))},onThemeChange:e=>{E(e),localStorage.setItem("theme",e?"dark":"light"),document.documentElement.classList.toggle("dark",e)},onExportCSV:T,onExportSerifOnly:P,onExportCharacterCSV:()=>{let t=[["名前","アイコン","グループ"],...e.map(e=>[e.name,e.emotions.normal.iconUrl,e.group])].map(e=>e.map(e=>e.includes(",")||e.includes("\n")||e.includes('"')?'"'.concat(e.replace(/"/g,'""'),'"'):e).join(",")).join("\r\n"),r=new Blob([t],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(r),s=document.createElement("a");s.href=l,s.download="characters.csv",s.click(),URL.revokeObjectURL(l)},onExportByGroups:L,onExportToClipboard:U,onImportCSV:B,onImportCharacterCSV:V,isDarkMode:_,saveDirectory:b,onSaveDirectoryChange:A,groups:r,onAddGroup:e=>{n(t=>[...t,e])},onDeleteGroup:e=>{n(t=>t.filter(t=>t!==e)),t(t=>t.map(t=>t.group===e?{...t,group:"なし"}:t))},onReorderCharacters:t,onReorderGroups:n,projectName:h.title,selectedBlockIds:f,onRenameProject:e=>{if(e.trim()&&e!==h.title){if(a(t=>t.map(t=>t===h.title?e:t)),c(e),p(t=>({...t,title:e})),w("voiscripter_".concat(e),JSON.stringify({...h,title:e})),w("voiscripter_lastProject",e),""===b)localStorage.removeItem("voiscripter_".concat(h.title));else if(window.electronAPI){var t;null===(t=window.electronAPI)||void 0===t||t.saveData("voiscripter_".concat(h.title),"")}}}}),(0,l.jsx)("main",{className:"p-4",children:(0,l.jsx)("div",{className:"max-w-6xl mx-auto",children:(0,l.jsx)(R,{script:{...h,characters:e},onUpdateBlock:(e,t)=>{p(r=>({...r,blocks:r.blocks.map(r=>r.id===e?{...r,...t}:r)}))},onAddBlock:()=>{var t;let r=[...h.blocks].reverse().find(e=>e.characterId),l=(null==r?void 0:r.characterId)||(null===(t=e[0])||void 0===t?void 0:t.id)||"",s=(null==r?void 0:r.emotion)||"normal",n={id:Date.now().toString(),characterId:l,emotion:s,text:""};p(e=>e.blocks.length>0&&e.blocks[e.blocks.length-1].id===n.id?e:{...e,blocks:[...e.blocks,n]})},onDeleteBlock:e=>{p(t=>({...t,blocks:t.blocks.filter(t=>t.id!==e)}))},onInsertBlock:(e,t)=>{p(r=>{let l=[...r.blocks];return l.splice(t,0,e),{...r,blocks:l}})},onMoveBlock:(e,t)=>{p(r=>{let l=[...r.blocks],[s]=l.splice(e,1);return l.splice(t,0,s),{...r,blocks:l}})},selectedBlockIds:f,onSelectedBlockIdsChange:g,onOpenCSVExport:()=>{let e=document.querySelector('[title="CSVエクスポート"]');e&&e.click()}})})})]}),(0,l.jsx)(O,{isOpen:j,onClose:()=>y(!1),onConfirm:e=>{c(e),a(t=>t.includes(e)?t:[...t,e]),p(t=>({id:"1",title:e,blocks:"default"===o?t.blocks:[]})),w("voiscripter_".concat(e),JSON.stringify({id:"1",title:e,blocks:"default"===o?h.blocks:[]})),w("voiscripter_lastProject",e)},existingProjects:i})]})}}},function(e){e.O(0,[800,971,69,744],function(){return e(e.s=382)}),_N_E=e.O()}]);